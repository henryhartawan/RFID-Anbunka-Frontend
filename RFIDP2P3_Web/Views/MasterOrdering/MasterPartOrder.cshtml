@{
	ViewData["Title"] = "Master Part Order";
	string myurl = new ConfigurationBuilder().AddJsonFile("appsettings.json").Build().GetSection("Path:URL").Value;
}

<style>
	.k-dropdown-wrap .k-input, .k-numeric-wrap .k-input, .k-picker-wrap .k-input {
		height: 30px;
	}
</style>

<div class="page-main">
	<div class="page-content padding-5">
		<div id="grid" style="margin-top:5px; margin-bottom:5px;"></div>
	</div>
</div>

<div class="modal fade modal-primary" id="editor" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h4 class="modal-title" id="myModalTitle">Master Part Order</h4>
			</div>
			<div class="modal-body margin-bottom-0 padding-bottom-0">
				<div class="panel">
					<div class="panel-body">
						<form class="form-horizontal">
							<div class="form-group form-material col-md-6">
								<label class="col-sm-3 control-label">Plant</label>
								<div class="col-sm-9">
									<input type="text" class="" id="Plant" style="width:100%;" />
								</div>
							</div>
							<div class="form-group form-material col-md-6">
								<label class="col-sm-3 control-label">Supplier</label>
								<div class="col-sm-9">
									<input type="text" class="" id="Supplier" style="width:100%;" />
								</div>
							</div>
							<div class="form-group form-material col-md-6">
								<label class="col-sm-3 control-label">Part No</label>
								<div class="col-sm-9">
									<input type="text" class="form-control" id="PartNumber" />
								</div>
							</div>
							<div class="form-group form-material col-md-6">
								<label class="col-sm-3 control-label">Part Name</label>
								<div class="col-sm-9">
									<input type="text" class="form-control" id="PartName" />
								</div>
							</div>
							<div class="form-group form-material col-md-6">
								<label class="col-sm-3 control-label">Job No</label>
								<div class="col-sm-9">
									<input type="text" class="form-control" id="JobNo" />
								</div>
							</div>
							<div class="form-group form-material col-md-6" style="height:37px;">
								<label class="col-sm-3 control-label">Qty/Box</label>
								<div class="col-sm-9">
									<input type="text" class="kendoNumber" id="QtyPerBox" style="width:100%;" />
								</div>
							</div>
							<div class="form-group form-material col-md-6">
								<label class="col-sm-3 control-label">UOM</label>
								<div class="col-sm-9">
									<input type="text" class="form-control" id="UOM" />
								</div>
							</div>
							<div class="form-group form-material col-md-6" style="height:37px;">
								<label class="col-sm-3 control-label">Part Type</label>
								<div class="col-sm-9">
									<input type="text" class="" id="PartType" style="width:100%;" />
								</div>
							</div>
							<div class="form-group form-material col-md-6" style="height:37px;">
								<label class="col-sm-3 control-label">Box Type</label>
								<div class="col-sm-9">
									<input type="text" class="" id="BoxType" style="width:100%;" />
								</div>
							</div>
							<div class="form-group form-material col-md-6" style="height:37px;">
								<label class="col-sm-3 control-label">Box / m3</label>
								<div class="col-sm-9">
									<input type="text" class="kendoDecimal" id="QtyBoxPerM3" style="width:100%;" />
								</div>
							</div>
							<div class="form-group form-material col-md-6" style="height:37px;">
								<label class="col-sm-3 control-label">Weight Gross (kg)</label>
								<div class="col-sm-9">
									<input type="text" class="" id="WeightGross" style="width:100%;" />
								</div>
							</div>
							<div class="form-group form-material col-md-6" id="divAD" style="height:37px;">
								<label class="col-sm-3 control-label">Allowance Deviasi</label>
								<div class="col-sm-9">
									<input type="text" class="kendoNumber" id="AllowanceDeviasi" style="width:100%;" />
								</div>
							</div>
							<div class="form-group form-material col-md-6" style="height:37px;">
								<label class="col-sm-3 control-label">Ratio Grade (%)</label>
								<div class="col-sm-9">
									<input type="text" class="kendoDecimal" id="RatioGrade" style="width:100%;" />
								</div>
							</div>
							<div class="clearfix"></div>
						</form>
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal" id='clear'>Close</button>
				<button type="button" class="btn btn-primary" id="btnSave">Submit</button>
			</div>
		</div>
	</div>
</div>

<div class="modal fade modal-primary" id="editorUpload" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="padding-top:25vh;">
	<div class="" role="document" style="padding-left:25vw;">
		<div class="modal-content" style="width:50vw">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h4 class="modal-title" id="myModalTitle">Upload Master Part Order</h4>
			</div>
			<div class="modal-body margin-bottom-0 padding-bottom-0">
				<form id="formUpload" enctype="multipart/form-data">
					<span>Download template <a href="../../templates/Master Part Order.xlsx" style="color:#0099ff" download="Template Master Part Order.xlsx">here</a></span>
					<input type="file" name="file" class="form-control" id="fileUpload" accept=".xls,.xlsx" />
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal" id='clear'>Close</button>
				<button type="button" class="btn btn-primary" id="btnSaveUpload" value="Upload">Upload</button>
			</div>
		</div>
	</div>
</div>

<script>
	var IUType = 'I';
	var PartOrderId = '';

	var AppD = {
		attachEvents: function () {
			var o = this;
			o.dom.$btnSave.on('click', o.eventHandlers.onClickBtnSave.bind(o));
			o.dom.$btnSaveUpload.on('click', o.eventHandlers.onClickBtnSaveUpload.bind(o));

			o.dom.$grid.on('click', '#btnCreate', o.eventHandlers.onClickBtnCreate.bind(o));
			o.dom.$grid.on('click', '#btnUpload', o.eventHandlers.onClickBtnUpload.bind(o));
			o.dom.$grid.on('click', '#btnExcel', o.eventHandlers.onClickBtnExcel.bind(o));

			o.dom.$grid.on('click', '.btnUpdate', o.eventHandlers.onClickBtnUpdate.bind(o));
			o.dom.$grid.on('click', '.btnDelete', o.eventHandlers.onClickBtnDelete.bind(o));
			o.dom.$grid.on('click', '.btnActive', o.eventHandlers.onClickBtnActive.bind(o));
			o.dom.$grid.on('click', '.btnDeactive', o.eventHandlers.onClickBtnActive.bind(o));
		},
		cacheDom: function () {
			var o = this;
			o.dom.$editor = $("#editor");
			o.dom.$grid = $("#grid");
			o.dom.$editorUpload = $("#editorUpload");
			o.dom.$btnSaveUpload = $("#btnSaveUpload");
			o.dom.$btnSave = $("#btnSave");
		},
		data: {},
		dom: {},
		eventHandlers: {
			onClickBtnCreate: function () {
				var o = this;
				IUType = 'I';
				PartOrderId = "";

				$("#Plant").data('kendoComboBox').value('');
				$("#Plant").data('kendoComboBox').enable(true);
				$("#Supplier").data('kendoComboBox').value('');
				$("#Supplier").data('kendoComboBox').enable(true);
				$("#PartNumber").val('');
				document.getElementById('PartNumber').disabled = false;
				$("#PartName").val('');
				$("#JobNo").val('');
				$("#QtyPerBox").data('kendoNumericTextBox').value('');
				$("#UOM").val('');
				$("#PartType").data('kendoDropDownList').value('');
				$("#BoxType").data('kendoComboBox').value('');
				$("#WeightGross").data('kendoNumericTextBox').value('');
				$("#AllowanceDeviasi").data('kendoNumericTextBox').value('');
				$("#QtyBoxPerM3").data('kendoNumericTextBox').value('');
				$("#RatioGrade").data('kendoNumericTextBox').value('');

				o.dom.$editor.modal('show');
			},
			onClickBtnDelete: function (e) {
				var o = this;
				var di = o.dom.$grid.data('kendoGrid').dataItem($(e.target).closest('tr'));

				swal.fire({
					title: 'Delete?',
					text: "You won't be able to revert this!",
					icon: 'warning',
					showCancelButton: true,
					confirmButtonText: 'Yes'
				}).then((result) => {
					if (result.isConfirmed) {
						$.ajax({
							method: 'post',
							headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
							url: "@myurl"+'MasterPartOrder/DEL',
							dataType: 'text',
							data: JSON.stringify({
								PartOrderID: di.PartOrderID
							})
						}).done(function (data, textStatus, jqXHR) {
							if (data !== 'success') {
								swal.fire('', data, 'error');
								return;
							}
							swal.fire({ title: 'Success', text: 'Data deleted', icon: 'success', timer: 2000, showConfirmButton: false });
						}).fail(function (jqXHR, textStatus, errorThrown) {
							swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
						}).always(function (data_or_jqXHR, textStatus, jqXHR_or_errorThrown) {
							o.dom.$grid.data('kendoGrid').dataSource.read();
						});
					}
				});
			},
			onClickBtnActive: function (e) {
				var o = this;
				var di = o.dom.$grid.data('kendoGrid').dataItem($(e.target).closest('tr'));

				swal.fire({
					title: di.PartOrderStatus == 'Active' ? 'Deactivate?' : 'Activate?',
					icon: 'warning',
					showCancelButton: true,
					confirmButtonText: 'Yes'
				}).then((result) => {
					if (result.isConfirmed) {
						$.ajax({
							method: 'post',
							headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
							url: "@myurl"+'MasterPartOrder/ACT',
							dataType: 'text',
							data: JSON.stringify({
								PartOrderID: di.PartOrderID,
								UserLogin: "@Context.Session.GetString("PIC_ID")"
							})
						}).done(function (data, textStatus, jqXHR) {
							if (data !== 'success') {
								swal.fire('', data, 'error');
								return;
							}
							swal.fire({ title: 'Success', text: di.PartOrderStatus == 'Active' ? 'Data Inactive' : 'Data Active', icon: 'success', timer: 2000, showConfirmButton: false });
						}).fail(function (jqXHR, textStatus, errorThrown) {
							swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
						}).always(function (data_or_jqXHR, textStatus, jqXHR_or_errorThrown) {
							o.dom.$grid.data('kendoGrid').dataSource.read();
						});
					}
				});
			},
			onClickBtnExcel: function () {
				var o = this;
				o.dom.$grid.data('kendoGrid').saveAsExcel();
			},
			onClickBtnUpdate: function (e) {
				var o = this;
				IUType = 'U';
				var di = o.dom.$grid.data('kendoGrid').dataItem($(e.target).closest('tr'));
				PartOrderId = di.PartOrderID;

				$("#Plant").data('kendoComboBox').value(di.PlantCode);
				$("#Plant").data('kendoComboBox').enable(false);
				$("#Supplier").data('kendoComboBox').value(di.SupplierCode);
				$("#Supplier").data('kendoComboBox').enable(false);
				$("#PartNumber").val(di.PartNumber);
				document.getElementById('PartNumber').disabled = true;
				$("#PartName").val(di.PartName);
				$("#JobNo").val(di.JobNo);
				$("#QtyPerBox").data('kendoNumericTextBox').value(di.QtyPerBox);
				$("#UOM").val(di.UOM);
				$("#PartType").data('kendoDropDownList').value(di.PartType);
				$("#BoxType").data('kendoComboBox').value(di.BoxType);
				$("#WeightGross").data('kendoNumericTextBox').value(di.WeightGross.replace(',', '.'));
				$("#AllowanceDeviasi").data('kendoNumericTextBox').value(di.AllowanceDeviasi);
				$("#QtyBoxPerM3").data('kendoNumericTextBox').value(di.QtyBoxPerM3);
				$("#RatioGrade").data('kendoNumericTextBox').value(di.RatioGrade.replace(',', '.'));

				o.dom.$editor.modal('show');
			},
			onClickBtnSave: function (e) {
				var o = this;
				var Plant = $("#Plant").data('kendoComboBox').value();
				var Supplier = $("#Supplier").data('kendoComboBox').value();
				var PartNumber = $("#PartNumber").val();
				var PartName = $("#PartName").val();
				var JobNo = $("#JobNo").val();
				var QtyPerBox = $("#QtyPerBox").val();
				var UOM = $("#UOM").val();
				var PartType = $("#PartType").data('kendoDropDownList').value();
				var BoxType = $("#BoxType").data('kendoComboBox').value();
				var WeightGross = $("#WeightGross").val();
				var AllowanceDeviasi = $("#AllowanceDeviasi").val();
				var QtyBoxPerM3 = $("#QtyBoxPerM3").val();
				var RatioGrade = $("#RatioGrade").val();

				if(Plant != '' && Supplier != '' && PartNumber != '' && PartName != '' && JobNo != '' &&
				  QtyPerBox != '' && QtyPerBox != 0 && UOM != '' && PartType != '' && BoxType != '' &&
				  WeightGross != '' && WeightGross != 0 && QtyBoxPerM3 != '' && QtyBoxPerM3 != 0 && RatioGrade != '' && RatioGrade != 0 &&
				  ((PartType.toUpperCase() == 'RAW CASTING' && AllowanceDeviasi != '' && AllowanceDeviasi != 0) || PartType.toUpperCase() != 'RAW CASTING')) {
					swal.fire({
						title: "Save?",
						icon: 'warning',
						showCancelButton: true,
						confirmButtonText: 'Yes'
					}).then((result) => {
						if (result.isConfirmed) {
							$.ajax({
								method: 'post',
								headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
								url: "@myurl" + 'MasterPartOrder/INS',
								dataType: 'text',
								data: JSON.stringify({
									PartOrderID: PartOrderId,
									PlantCode: Plant,
									SupplierCode: Supplier,
									PartNumber: PartNumber,
									PartName: PartName,
									JobNo: JobNo,
									QtyPerBox: QtyPerBox,
									UOM: UOM,
									PartType: PartType,
									BoxType: BoxType,
									WeightGross: WeightGross,
									AllowanceDeviasi: AllowanceDeviasi,
									QtyBoxPerM3: QtyBoxPerM3,
									RatioGrade: RatioGrade,
									IUType: IUType,
									UserLogin: "@Context.Session.GetString("PIC_ID")"
								})
							}).done(function (data, textStatus, jqXHR) {
								if (data !== 'success') {
									swal.fire('Error', data, 'error');
									return;
								}
								o.dom.$editor.modal('hide');
								swal.fire({ title: 'Success', text: 'Data saved', icon: 'success', timer: 2000, showConfirmButton: false });
							}).fail(function (jqXHR, textStatus, errorThrown) {
								swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
							}).always(function (data_or_jqXHR, textStatus, jqXHR_or_errorThrown) {
								o.dom.$grid.data('kendoGrid').dataSource.read();
							});
						}
					});
				}else{
					swal.fire({ title: 'Warning', text: 'Please fill all fields', icon: 'warning'});
				}
			},
			onClickBtnUpload: function () {
				var o = this;
				$("#fileUpload").data('kendoUpload').clearAllFiles();
				o.dom.$editorUpload.modal('show');
			},
			onClickBtnSaveUpload: function () {
				var o = this;
				swal.fire({
					title: 'Upload Master Part Order?',
					icon: 'warning',
					showCancelButton: true,
					confirmButtonText: 'Yes'
				}).then((result) => {
					if (result.isConfirmed) {
						let formData = new FormData();
						let files = $("#fileUpload").data('kendoUpload').getFiles();
						let file = files[0].rawFile;
						formData.append('file', file);

						$.ajax({
							url: "@myurl" + "MasterPartOrder/Upload?UID=" + "@Context.Session.GetString("PIC_ID")",
							headers: { 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
							type: 'post',
							data: formData,
							contentType: false,
							processData: false
						}).done(function (data, textStatus, jqXHR) {
							var remarks = data[0].Remarks;
							if(remarks != '') {
								swal.fire({ title: 'Warning', text: remarks, icon: 'warning'});
							} else {
								o.dom.$editorUpload.modal('hide');
								swal.fire({ title: 'Success', text: 'Data Uploaded', icon: 'success', timer: 2000, showConfirmButton: false });
								$("#fileUpload").data('kendoUpload').clearAllFiles();
							}
						}).always(function (data_or_jqXHR, textStatus, jqXHR_or_errorThrown) {
							$("#grid").data('kendoGrid').dataSource.read();
							$("#fileUpload").data('kendoUpload').clearAllFiles();
						});
					}
				});
			},
		},
		init: function () {
			var o = this;
			o.cacheDom();
			o.attachEvents();
			o.initElements();
		},
		initElements: function () {
			var o = this;

			o.dom.$grid.kendoGrid({
				excel: {
					fileName: "Master Part Order.xlsx",
					allPages: true,
					filterable: true
				},
				dataSource: {
					transport: {
						read: function (options) {
							$.ajax({
								method: 'post',
								headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
								url: "@myurl"+'MasterPartOrder/INQ',
								dataType: 'text',
								data: {}
							}).done(function (data, textStatus, jqXHR) {
								try {
									var result = JSON.parse(data);
								}
								catch (e) {
									swal.fire('Error', 'Error loading grid', 'error');
									options.success({ data: [] });
									return;
								}
								options.success(result);
							}).fail(function (jqXHR, textStatus, errorThrown) {
								swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
								options.success({ data: [] });
							});
						}
					},
					schema: {
						model: {
							id: "PartOrderID",
							fields: {
								PartOrderID: { type: "string" },
								PlantCode: { type: "string" },
								Supplier: { type: "string" },
								PartNumber: { type: "string" },
								PartName: { type: "string" },
								JobNo: { type: "string" },
								QtyPerBox: { type: "string" },
								UOM: { type: "string" },
								PartType: { type: "string" },
								BoxType: { type: "string" },
								WeightGross: { type: "string" },
								AllowanceDeviasi: { type: "string" },
								QtyBoxPerM3: { type: "string" },
								RatioGrade: { type: "string" },
								PartOrderStatus: { type: "string" },
								LastUpdate: { type: "string" },
								UserUpdate: { type: "string" },
								Remarks: { type: "string" },
							}
						}
					},
					pageSize: 20
				},
				scrollable: true,
				sortable: true,
				resizable: true,
				reorderable: true,
				filterable: {
					extra: false,
					operators: {
						string: {
							contains: "Contains",
							eq: "Equal to",
							neq: "Not equal to"
						}
					}
				},
				pageable: {
					refresh: true,
					input: true,
					numeric: true,
					pageSizes: true,
					buttonCount: 5
				},
				columns: [
				@if (Context.Session.GetString("edit_master_part_order") == "True")
				{
					<text>
					{
						width: 50,
						command: [{
							name: "Update",
							text: "<i class='fa fa-pencil-square-o btnUpdate' style='font-size:18px;color:#737373;'></i>"
						}]
					},
					</text>
				}
				@if (Context.Session.GetString("del_master_part_order") == "True")
				{
					<text>
					{
						width: 50,
						command: [{
							name: "Delete",
							text: "<i class='fa fa-trash-o btnDelete' style='font-size:18px;color:#800000;'></i>"
						}]
					},
					</text>
				}
				@if (Context.Session.GetString("edit_master_part_order") == "True")
				{
					<text>
					{
						width: 50,
						command: [{
							name: "Active",
							text: "<i class='fa fa-check btnActive' style='font-size:18px;color:#008000;'></i>"
						},{
							name: "Deactive",
							text: "<i class='fa fa-times btnDeactive' style='font-size:18px;color:#ff0000;'></i>"
						}]
					},
					</text>
				}
				{
					field: "PartOrderID",
					title: "ID",
					width: 50
				},
				{
					field: "PlantCode",
					title: "Plant",
					width: 100
				},
				{
					field: "Supplier",
					title: "Supplier",
					width: 250,
					template: "<div class='customClass'> #= (Supplier == null) ? ' ' : kendo.toString(Supplier, '') # </div>",
				},
				{
					field: "PartNumber",
					title: "Part Number",
					width: 150,
				},
				{
					field: "PartName",
					title: "Part Name",
					width: 200,
					template: "<div class='customClass'> #= (PartName == null) ? ' ' : kendo.toString(PartName, '') # </div>",
				},
				{
					field: "JobNo",
					title: "Job No",
					width: 100,
				},
				{
					field: "QtyPerBox",
					title: "Qty/Box",
					width: 100,
				},
				{
					field: "UOM",
					title: "UOM",
					width: 100,
				},
				{
					field: "PartType",
					title: "Part Type",
					width: 100,
				},
				{
					field: "BoxType",
					title: "Box Type",
					width: 100,
				},
				{
					field: "QtyBoxPerM3",
					title: "Box / m3 ",
					width: 100,
				},
				{
					field: "WeightGross",
					title: "Weight Gross (kg)",
					width: 100,
				},
				{
					field: "AllowanceDeviasi",
					title: "Allowance Deviasi",
					width: 100,
				},
				{
					field: "RatioGrade",
					title: "Ratio Grade (%)",
					width: 100,
				},
				{
					field: "PartOrderStatus",
					title: "Status",
					width: 100
				},
				{
					title: "Last Update",
					columns: [
					{
						field: "UserUpdate",
						title: "User",
						width: 100
					},
					{
						field: "LastUpdate",
						title: "Date",
						width: 150
					}]
				}],
				toolbar: $("#template_toolbar").html(),
				dataBound: function(e){
					var grid = this;

					grid.tbody.find("tr[role='row']").each(function(){
						var model = grid.dataItem(this);
						if(model.PartOrderStatus == 'Active'){
							$(this).find(".k-grid-Active").hide();
							$(this).find(".k-grid-Deactive").show();
						}else{
							$(this).find(".k-grid-Active").show();
							$(this).find(".k-grid-Deactive").hide();
						}
					});
				}
			});

			$("#Plant").kendoComboBox({
				dataValueField: "IdValue",
				dataTextField: "ViewValue",
				filter: "contains",
				dataSource: {
					transport: {
						read: function (options) {
							$.ajax({
								method: 'post',
								headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
								url: "@myurl" + 'DropDown/INQ',
								dataType: 'text',
								data: JSON.stringify({ Ftype: "PlantCode", Plant: "" })
							}).done(function (data, textStatus, jqXHR) {
								try {
									var result = JSON.parse(data);
								}
								catch (e) {
									swal.fire('Error', 'Error loading grid', 'error');
									options.success({ data: [] });
									return;
								}
								options.success(result);
							}).fail(function (jqXHR, textStatus, errorThrown) {
								swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
								options.success({ data: [] });
							});
						}
					}
				},
				change: function(){
					if (this.value() && this.selectedIndex == -1) {
						this.text("");
						this.value(null);
					}
				}
			}).data("kendoComboBox");

			$("#Supplier").kendoComboBox({
				dataValueField: "IdValue",
				dataTextField: "ViewValue",
				filter: "contains",
				dataSource: {
					transport: {
						read: function (options) {
							$.ajax({
								method: 'post',
								headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
								url: "@myurl" + 'DropDown/INQ',
								dataType: 'text',
								data: JSON.stringify({ Ftype: "Supplier", Plant: "" })
							}).done(function (data, textStatus, jqXHR) {
								try {
									var result = JSON.parse(data);
								}
								catch (e) {
									swal.fire('Error', 'Error loading grid', 'error');
									options.success({ data: [] });
									return;
								}
								options.success(result);
							}).fail(function (jqXHR, textStatus, errorThrown) {
								swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
								options.success({ data: [] });
							});
						}
					}
				},
				change: function(){
					if (this.value() && this.selectedIndex == -1) {
						this.text("");
						this.value(null);
					}
				}
			}).data("kendoComboBox");

			$("#BoxType").kendoComboBox({
				dataValueField: "IdValue",
				dataTextField: "ViewValue",
				filter: "contains",
				dataSource: {
					transport: {
						read: function (options) {
							$.ajax({
								method: 'post',
								headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
								url: "@myurl" + 'DropDown/INQ',
								dataType: 'text',
								data: JSON.stringify({ Ftype: "BoxType", Plant: "" })
							}).done(function (data, textStatus, jqXHR) {
								try {
									var result = JSON.parse(data);
								}
								catch (e) {
									swal.fire('Error', 'Error loading grid', 'error');
									options.success({ data: [] });
									return;
								}
								options.success(result);
							}).fail(function (jqXHR, textStatus, errorThrown) {
								swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
								options.success({ data: [] });
							});
						}
					}
				},
				change: function(){
					if (this.value() && this.selectedIndex == -1) {
						this.text("");
						this.value(null);
					}
				}
			}).data("kendoComboBox");

			$("#divAD").hide();

			$("#PartType").kendoDropDownList({
				dataSource: [
					{ id: "OEM", name: "OEM"},
					{ id: "OEM-Grade", name: "OEM-Grade"},
					{ id: "Consumable", name: "Consumable"},
					{ id: "Raw Casting", name: "Raw Casting"},
					{ id: "DPR", name: "DPR"},
				],
				dataValueField: "id",
				dataTextField: "name",
				change: function(){
					var PartType = this.value();
					$("#AllowanceDeviasi").data('kendoNumericTextBox').value('');
					if(PartType == 'RAW CASTING') {
						$("#divAD").show();
					} else {
						$("#divAD").hide();
					}
				}
			}).data("kendoDropDownList");

			$(".kendoNumber").kendoNumericTextBox({
				format: "#",
				min: 0,
				decimals: 0,
				restrictDecimals: true
			});

			$("#WeightGross").kendoNumericTextBox({
				format: "#.###",
				min: 0,
				decimals: 3,
				restrictDecimals: true
			});

			$("#fileUpload").kendoUpload({
				multiple: false,
				validation: {
					allowedExtensions: [".xls", "xlsx"]
				}
			});

			$(".kendoDecimal").kendoNumericTextBox({
				format: "#.##",
				min: 0,
				decimals: 2,
				restrictDecimals: true,
				max: 100
			});
		},
	};

	$(function () {
		AppD.init();
	});
</script>

<script type="text/x-kendo-template" id="template_toolbar">
	<span class="k-pager-refresh" style="font-weight: bold">&nbsp;&nbsp;- Master Part Order -&nbsp;&nbsp;</span>
	<div class="toolbar">
	@if (Context.Session.GetString("add_master_part_order") == "True")
	{
		<button data-toggle="tooltip" title="Create" type="button" class="btn ink-reaction btn-floating-action btn-xs btn-warning" id="btnCreate">
			<i class="k-icon k-i-plus"></i>
		</button>
		<button data-toggle="tooltip" title="Upload" type="button" class="btn ink-reaction btn-floating-action btn-xs btn-warning" id="btnUpload">
			<i class="k-icon k-i-upload"></i>
		</button>
	}
		<button data-toggle="tooltip" title="Save as Excel" type="button" class="btn ink-reaction btn-floating-action btn-xs btn-warning" id="btnExcel">
			<i class="k-icon k-i-excel"></i>
		</button>
	</div>
</script>
