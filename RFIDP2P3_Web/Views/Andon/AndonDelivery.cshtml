@{
    ViewData["Title"] = "Andon Monitoring Delivery";
    string myurl = new ConfigurationBuilder().AddJsonFile("appsettings.json").Build().GetSection("Path:URL").Value;
    Layout = "~/Views/Shared/_LayoutAndon.cshtml";

}

<style>
    #tbHead td {
        height: 12px;
    }

    #Build {
        position: absolute;
        bottom: 5px;
        border: solid 1px white;
        left: 59vw;
    }
    #GridTittle{
        text-align:center;
        font-size:5vh;
        font-weight:bold;
    }
    .page-main {
        overflow: auto;
        padding: 0 !important;
    }

    .k-grid-content {
        overflow: auto;
    }

    .k-grid-header {
        padding: 0 !important;
    }

    thead th {
        font-size: 1.9vh;
        text-align: center;
        font-weight: bolder;
        vertical-align:middle;
    }

    tbody td {
        font-size: 2.2vh;
    }

    thead td {
        font-size: 1.9vh;
        text-align: center;
        vertical-align:middle;
        font-weight: bolder;
    }

    .customClass1 {
        text-align: center;
    }

    .custom1 {
        text-align: center;

    }

    .customClass {
        text-align: center;
    }

    .ClassDetail {
        text-align: left;
        font-size: 2.1vh;
        font-weight: bold;
    }
    .ClassDetail1 {
        /*text-align: center;*/
        font-weight: bold;
    }
    .k-header {
        text-align: center;
    }
    .k-grid {
        border-color: #fafafa;

        font-weight: bolder;
    }

    .k-/*grid td {
        font-size: 14px;
        height: 13px;
    }*/
        
    .k-grid th {
        font-size: 18vh;
    }

    .AndonHeader {
        background-color: #42f5bf;
    }

    .flex {
        display: flex;
        text-align: center;
    }

    
    .customClass2 {
        text-align:center;
        font-size: 35px;
    }

    .customClass3 {
        text-align: center;
        height: 20px;
        margin-top: 10px;
    }

    .customClass3 .sym {
        font-size: 30px;
    }

    .customClass3 .stat {
        font-size: 20px;
    }

    .custClass1 {
        font-size: 1.7vh;
    }

    .k-grid-content .k-alt {
        background-color: #b3cccc;
    }

    .progress0 {
        width: 50px;
    }

    .progress1 {
        width: 50px;
    }

    .Notes {
        width: 96vw;
        background-color: #000000;
        color: #ffffff;
        text-align: center;
        font-size: 1.7vh;
    }

    #top {
        position: absolute;
        top: -25px;
    }
    #gridDeliv{
        padding-top:0px;    }

    .customQty{
        font-size: 50px;
        text-align: center;
    }


    #GridPairDet .k-grid-content .k-alt {
        background-color: #F2D063;
    }
</style>

<div class="page-main" id="top">

        <div id="gridPre" style="width:99%;"></div>
        <div id="gridDeliv" style="width:99%;"></div>

        <div id="GridPair" style="width:99%;"></div>
        <div id="GridPairDet" style="width:99%;"></div>

</div>

<script>
    var gedung = localStorage['gedungP3'] != undefined ? localStorage['gedungP3'] : ""; 
    var shift = ""; var intr = 1; var change = 0; var change1 = 0;
    const days = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];
    const months = ["Januari", "Pebruari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
    var tomorrow = new Date(); tomorrow.setDate(tomorrow.getDate() + 1);
    var d = new Date(); var clr = "#DAC0A3";
    var hari = days[d.getDay()];
    var bulan = months[d.getMonth()];
    var tahun = d.getFullYear(); var preID ="";
    var tanggal = d.getDate() + " " + bulan + " " + tahun;
    var tanggal1 = tomorrow.getDate() + " " + months[tomorrow.getMonth()] + " " + tomorrow.getFullYear();
    var dateDefault = new Date();

    var tabGrid1 = '0'; var resx = 0;
    var tabGrid2 = '0'; var tmp = 0;


    var hour = d.getHours();
    hour = hour > 9 ? hour : '0' + hour;
    var minute = d.getMinutes();
    minute = minute > 9 ? minute : '0' + minute;
    var jam = hour + ':' + minute;

    $("#Period_From").kendoDatePicker({
        format: 'dd/MM/yyyy',
        value: dateDefault,
        //change: o.eventHandlers.onChangeDate.bind(o)
    });
    $("#Period_To").kendoDatePicker({
        format: 'dd/MM/yyyy',
        value: dateDefault,
        //change: o.eventHandlers.onChangeDate.bind(o)
    });

    var AppD = {
        attachEvents: function () {
            var o = this;

        },
        cacheDom: function () {
            var o = this;
            o.dom.$grid = $("#gridPre");
            o.dom.inputs = {};
            o.dom.inputs.$inputMaterialNo = $("#MaterialNo");
            o.dom.inputs.$inputJobNo = $("#JobNo");
            o.dom.inputs.$inputMaterialName = $("#MaterialName");
            o.dom.inputs.$inputMaterialDescription = $("#MaterialDescription");
            o.dom.inputs.$inputQtyPerBox = $("#QtyPerBox");
        },
        data: {},
        dom: {},
        eventHandlers: {

            onClickBtnCreate: function () {
                var o = this;
                getShop('X');
                $("#myModalLabel").html("Add New Part");
                o.dom.inputs.$inputMaterialNo.val('');
                o.dom.inputs.$inputJobNo.val('');
                o.dom.inputs.$inputMaterialName.val('');
                o.dom.inputs.$inputMaterialDescription.val('');
                o.dom.inputs.$inputQtyPerBox.val('');

                var modal = document.getElementById("myModal");
                modal.style.display = "block";
                window.onclick = function (event) {
                    if (event.target == modal) {
                        modal.style.display = "none";
                    }
                }
                var cancel = document.getElementById("btnCancel");
                cancel.onclick = function () {
                    modal.style.display = "none";
                }
            },
            onClickBtnUpdate: function (e) {
                var o = this;

                var di = o.dom.$grid.data('kendoGrid').dataItem($(e.target).closest('tr'));
                $("#myModalLabel").html("Edit Part");
                o.dom.inputs.$inputMaterialNo.val(di.MaterialNo);
                o.dom.inputs.$inputJobNo.val(di.JobNo);
                o.dom.inputs.$inputMaterialName.val(di.MaterialName);
                o.dom.inputs.$inputMaterialDescription.val(di.MaterialDescription);
                o.dom.inputs.$inputQtyPerBox.val(di.QtyPerBox);

                var modal = document.getElementById("myModal");
                modal.style.display = "block";
                window.onclick = function (event) {
                    if (event.target == modal) {
                        modal.style.display = "none";
                    }
                }
                var cancel = document.getElementById("btnCancel");
                cancel.onclick = function () {
                    modal.style.display = "none";
                }
            }
        },
        init: function () {
            var o = this;
            o.cacheDom();
            o.attachEvents();
            o.initElements();
        },
        initElements: function () {
            var o = this;

        },
        initAfter: function () {

            $("#BuildingID").kendoDropDownList({
                template: '<span>#:data.Plant# - #:data.IdValue# - #:data.ViewValue#</span>',
                valueTemplate: '<span>#:data.Plant# - #:data.IdValue# - #:data.ViewValue#</span>',
                optionLabel: "select building...",
                dataValueField: "IdValue",
                dataSource: {
                    transport: {
                        read: function (options) {
                            $.ajax({
                                method: 'post',
                                headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
                                url: "@myurl" + 'DropDown/INQ',
                                dataType: 'text',
                                data: JSON.stringify({ Ftype: "Gedung", Plant: "P3" })
                            }).done(function (data, textStatus, jqXHR) {
                                try {
                                    var result = JSON.parse(data);
                                }
                                catch (e) {
                                    //swal.fire('Error', 'Error loading grid', 'error');
                                    options.success({ data: [] });
                                    return;
                                }
                                options.success(result);
                            }).fail(function (jqXHR, textStatus, errorThrown) {
                                //swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
                                options.success({ data: [] });
                            });
                        }
                    }
                },
                change: function (e) {
                    var value = this.value();
                    value = value == null? '' : value;
                    if (value != '') {
                        localStorage['gedungP3'] = value;
                    }
                    intr = 0; change=0;
                    // Use the value of the widget
                }
            }).data("kendoDropDownList");

            gedung = localStorage['gedungP3'] != undefined ? localStorage['gedungP3'] : gedung;
            $("#BuildingID").data("kendoDropDownList").value(gedung);
        }
    };

    $(function () {
        ////console.log('&nbsp;' + jam);
        $("#hari").html(hari);
        $("#tanggal").html(tanggal);

        $.ajax({
            method: 'post',
            headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
            url: "@myurl" + 'Andon/Shift',
            dataType: 'text',
            data: JSON.stringify({ Plant: 'P3' })
        }).done(function (data, textStatus, jqXHR) {
            try {
                var result = JSON.parse(data);
                //console.log(result[0].shift);
                shift = result[0].shift;
            }
            catch (e) {
                //swal.fire('Error', 'Error loading grid', 'error');

                return;
            }
        }).fail(function (jqXHR, textStatus, errorThrown) {
            //swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');

        });

        $("#shift").html(shift);
        $("#jamx").html('&nbsp;' + jam);
        AppD.init(); //isiGrid2();
        isiGrid();
    });
    var ckrow=0;
    function isiGrid2() {
        $("#gridPre").html("");
        $("#gridPre").kendoGrid({
            //height: 320,
            excel: {
                fileName: "Andon Bufferxlsx",
                allPages: true,
                filterable: true
            },
            dataSource: {
                transport: {
                    read: function (options) {

                        $.ajax({
                            method: 'post',
                            headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
                            url: "@myurl" + 'Andon/AndonDeliveryDetail',
                            dataType: 'text',
                            data: JSON.stringify({ tabGrid: tabGrid2, gedung: gedung })
                        }).done(function (data, textStatus, jqXHR) {
                            try {
                                var result = JSON.parse(data);
                                change1 = result.length > 0 ? parseInt(result[0].tabGrid) : 0;
                                ckrow = result.length;
                                //change1 = result.length == 0 ? 0 : result[0].tabGrid == 0? 0:1;
                                tabGrid2 = change1.toString();
                            }
                            catch (e) {
                                //swal.fire('Error', 'Error loading grid', 'error');
                                options.success({ data: [] });
                                return;
                            }
                            options.success(result);
                        }).fail(function (jqXHR, textStatus, errorThrown) {
                            //swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
                            options.success({ data: [] });
                        });
                    }
                },
                schema: {
                    model: {
                        id: "PartNumber",
                        fields: {
                            Nos: { type: "string" },
                            PartNumber: { type: "string" },
                            PartName: { type: "string" },
                            DateCycle: { type: "string" },
                            DA1: { type: "string" },
                            DA2: { type: "string" },
                            DA3: { type: "string" },
                            DA4: { type: "string" },
                            DA5: { type: "string" },
                            DA6: { type: "string" },
                            DA7: { type: "string" },
                            DA8: { type: "string" },
                            DB1: { type: "string" },
                            DB2: { type: "string" },
                            DB3: { type: "string" },
                            DB4: { type: "string" },
                            DB5: { type: "string" },
                            DB6: { type: "string" },
                            DB7: { type: "string" },
                            DB8: { type: "string" },
                        }
                    }
                },
                //pageSize: 20
            },
            columns: [
                { field: "Nos", width: 40, title: "No", template: "<div class='ClassDetail'> #= ( Nos== null) ? ' ' : kendo.toString(Nos, '') # </div>", },
                { field: "PartNumber", width: 170,  title: "Part Number", template: "<div class='ClassDetail'> #= ( PartNumber== null) ? ' ' : kendo.toString(PartNumber, '') # </div>", },
                { field: "PartName", width: 170,  title: "Part Name", template: "<div class='ClassDetail'> #= ( PartName== null) ? ' ' : kendo.toString(PartName, '') # </div>", },
                { field: "DateCycle", width:80, title: "Date<br>Cycle", template: "<div class='ClassDetail1'> #= ( DateCycle== null) ? ' ' : kendo.toString(DateCycle, '') # </div>",
                    attributes: { 'style': "#=DateCycle=='Act Deviasi'?'background-color: LightSalmon;':'GhostWhite'#" },
                },
                {field: tanggal, columns:[
                    { field: "DA1", width:50, title: "1", template: "<div class='ClassDetail'> #= (DA1 == null) ? ' ' : kendo.toString(DA1, '') # </div>", },
                    { field: "DA2", width:50, title: "2", template: "<div class='ClassDetail'> #= (DA2 == null) ? ' ' : kendo.toString(DA2, '') # </div>", },
                    { field: "DA3", width:50, title: "3", template: "<div class='ClassDetail'> #= (DA3 == null) ? ' ' : kendo.toString(DA3, '') # </div>", },
                    { field: "DA4", width:50, title: "4", template: "<div class='ClassDetail'> #= (DA4 == null) ? ' ' : kendo.toString(DA4, '') # </div>", },
                    { field: "DA5", width:50, title: "5", template: "<div class='ClassDetail'> #= (DA5 == null) ? ' ' : kendo.toString(DA5, '') # </div>", },
                    { field: "DA6", width:50, title: "6", template: "<div class='ClassDetail'> #= (DA6 == null) ? ' ' : kendo.toString(DA6, '') # </div>", },
                    { field: "DA7", width:50, title: "7", template: "<div class='ClassDetail'> #= (DA7 == null) ? ' ' : kendo.toString(DA7, '') # </div>", },
                    { field: "DA8", width:50, title: "8", template: "<div class='ClassDetail'> #= (DA8 == null) ? ' ' : kendo.toString(DA8, '') # </div>", },
                    ]
                },
                {field: tanggal1, columns: [
                    { field: "DB1", width:50, title: "1", template: "<div class='ClassDetail'> #= (DB1 == null) ? ' ' : kendo.toString(DB1, '') # </div>", },
                    { field: "DB2", width:50, title: "2", template: "<div class='ClassDetail'> #= (DB2 == null) ? ' ' : kendo.toString(DB2, '') # </div>", },
                    { field: "DB3", width:50, title: "3", template: "<div class='ClassDetail'> #= (DB3 == null) ? ' ' : kendo.toString(DB3, '') # </div>", },
                    { field: "DB4", width:50, title: "4", template: "<div class='ClassDetail'> #= (DB4 == null) ? ' ' : kendo.toString(DB4, '') # </div>", },
                    { field: "DB5", width:50, title: "5", template: "<div class='ClassDetail'> #= (DB5 == null) ? ' ' : kendo.toString(DB5, '') # </div>", },
                    { field: "DB6", width:50, title: "6", template: "<div class='ClassDetail'> #= (DB6 == null) ? ' ' : kendo.toString(DB6, '') # </div>", },
                    { field: "DB7", width:50, title: "7", template: "<div class='ClassDetail'> #= (DB7 == null) ? ' ' : kendo.toString(DB7, '') # </div>", },
                    { field: "DB8", width:50, title: "8", template: "<div class='ClassDetail'> #= (DB8 == null) ? ' ' : kendo.toString(DB8, '') # </div>", },
                ]}
            ],
            toolbar: $("#template_toolbar").html(),
            dataBound: function (e) {

                $("#BuildingID").kendoDropDownList({
                    template: '<span>#:data.Plant# - #:data.IdValue# - #:data.ViewValue#</span>',
                    valueTemplate: '<span>#:data.Plant# - #:data.IdValue# - #:data.ViewValue#</span>',
                    optionLabel: "select building...",
                    dataValueField: "IdValue",
                    dataSource: {
                        transport: {
                            read: function (options) {
                                $.ajax({
                                    method: 'post',
                                    headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
                                    url: "@myurl" + 'DropDown/INQ',
                                    dataType: 'text',
                                    data: JSON.stringify({ Ftype: "Gedung", Plant: "P3" })
                                }).done(function (data, textStatus, jqXHR) {
                                    try {
                                        var result = JSON.parse(data);
                                    }
                                    catch (e) {
                                        //swal.fire('Error', 'Error loading grid', 'error');
                                        options.success({ data: [] });
                                        return;
                                    }
                                    options.success(result);
                                }).fail(function (jqXHR, textStatus, errorThrown) {
                                    //swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
                                    options.success({ data: [] });
                                });
                            }
                        }
                    },
                    change: function (e) {
                        var value = this.value();
                        value = value == null ? '' : value;
                        if (value != '') {
                            localStorage['gedungP3'] = value;
                        }
                        intr = 0; change = 0;
                        // Use the value of the widget
                    }
                }).data("kendoDropDownList");
                gedung = localStorage['gedungP3'] != undefined ? localStorage['gedungP3'] : gedung;
                $("#BuildingID").data("kendoDropDownList").value(gedung);
                $("#hari").html(hari);
                $("#tanggal").html(tanggal);
                $("#jamx").html('&nbsp;' + jam);
                $(".AndonHeader").css('background-color', '#42f5bf');
                $("#GridTittle").html("Andon Monitoring Delivery");


                //$("tbody tr").css('height', '20px');:;:;

                $("#gridPre tbody td").css('text-align', 'center');

                $("#gridPre thead th").css('background-color', '#4472C4');
                $("#gridPre thead th").css('color', '#ffffff');
                $("#gridPre thead th").css('font-weight', 'bold');
                $("#gridPre thead th").css('text-align', 'center');
                $("#gridPre thead th").css('font-size', '1.8vh');
                $("#gridPre thead th").css('font-weight', 'bold');
                $("#gridPre thead th").css('vertical-align', 'middle');
                $("#gridPre thead tr").css('vertical-align', 'middle');
                $("#gridPre tbody tr").css('height', '10px');

                if (ckrow > 0) {//44444
                    const table = document.querySelector('#gridPre .k-grid-content table');
                    let headerCell = null;let headerCell2 = null;let headerCell3 = null;
                    for (let row of table.rows) {
                        const firstCell = row.cells[0];const secondCell = row.cells[1];const thirdCell = row.cells[2];
                        console.log(secondCell.innerText);
                        if (secondCell.innerText != '' && secondCell.innerText != null) {
                            headerCell2 = secondCell;
                            headerCell = firstCell;
                            headerCell3 = thirdCell;
                        }
                        else {
                            headerCell.rowSpan++;
                            headerCell2.rowSpan++;
                            headerCell3.rowSpan++;
                            firstCell.remove();
                            secondCell.remove();
                            thirdCell.remove();
                        }

                    }
                }
            }
        });
    }
    function isiGrid() {
        $("#gridPre").html("");
        $("#gridDeliv").html("");
        $("#gridDeliv").kendoGrid({
            //height: 320,
            excel: {
                fileName: "Andon Bufferxlsx",
                allPages: true,
                filterable: true
            },
            dataSource: {
                transport: { 
                    read: function (options) {
                        $.ajax({
                            method: 'post',
                            headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
                            url: "@myurl" + 'Andon/AndonDelivery',
                            dataType: 'text',
                            data: JSON.stringify({gedung: gedung })
                        }).done(function (data, textStatus, jqXHR) {
                            try {
                                var result = JSON.parse(data);
                                resx = result.length;
                                //console.log(result);
                            }
                            catch (e) {
                                //swal.fire('Error', 'Error loading grid', 'error');
                                options.success({ data: [] });
                                return;
                            }
                            options.success(result);
                        }).fail(function (jqXHR, textStatus, errorThrown) {
                            //swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
                            options.success({ data: [] });
                        });
                    }
                },
                schema: {
                    model: {
                        id: "PartNumber",
                        fields: {
                            leftLabel: { type: "string" },                            
                            rightLabel: { type: "string" },
                            NR1: { type: "string" }, NR2: { type: "string" }, NR3: { type: "string" }, NR4: { type: "string" }, NR5: { type: "string" }, NR6: { type: "string" }, NR7: { type: "string" }, NR8: { type: "string" },
                            SZKR1: { type: "string" }, SZKR2: { type: "string" }, SZKR3: { type: "string" }, SZKR4: { type: "string" }, WAD1: { type: "string" }, WAD2: { type: "string" },
                        }
                    }
                },
                //pageSize: 20
            },
            columns: [

                {
                    field: 'DELIVERY STATUS', columns: [

                        {
                                 title: "Desc.",
                           // attributes: { 'style': "background-color:LightSteelBlue;border-bottom:solid 1px white;#" },
                            columns: [{
                                field: "leftLabel", title: "Cycle", template: "<div class='custClass1'> #= leftLabel # </div>", width: 80,
                               // attributes: { 'style': "background-color:LightSteelBlue;border-bottom:solid 1px white;#=leftLabel=='Progress Status'?'font-size:1.4vh':'font-size:1.7vh'#" },
                            }]
                        },
                        {
                            title: "Desc.",
                            columns: [
                                { field: "rightLabel", title: "Blank", template: "<div class='custClass1'> #= (rightLabel == null) ? ' ' : kendo.toString(rightLabel, '') # </div>", width: 80 },]
                        },
                        {
                            field: "NR", columns: [

                                {
                                    field: "NR1", title: "1", template: "<div>#= ( NR1== 0) ? ' ' : kendo.toString(NR1, '') # </div>",
                                    attributes: { 'style': "height:14px;#=leftLabel=='Progress Status'?  ( NR1== null) ? 'background-color:yellow;':( NR1== '0%')? 'background-color:yellow;font-size:2vh;':(NR1=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "NR2", title: "2", template: "<div>#= ( NR2== 0) ? ' ' : kendo.toString(NR2, '') # </div>",
                                    attributes: { 'style': "height:14px;#=leftLabel=='Progress Status'?  ( NR2== null) ? 'background-color:yellow;':( NR2== '0%')? 'background-color:yellow;font-size:2vh;':(NR2=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "NR3", title: "3", template: "<div>#= ( NR3== 0) ? ' ' : kendo.toString(NR3, '') # </div>",
                                    attributes: { 'style': "height:14px;#=leftLabel=='Progress Status'?  ( NR3== null) ? 'background-color:yellow;':( NR3== '0%')? 'background-color:yellow;font-size:2vh;':(NR3=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "NR4", title: "4", template: "<div>#= ( NR4== 0) ? ' ' : kendo.toString(NR4, '') # </div>",
                                    attributes: { 'style': "height:14px;#=leftLabel=='Progress Status'?  ( NR4== null) ? 'background-color:yellow;':( NR4== '0%')? 'background-color:yellow;font-size:2vh;':(NR4=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "NR5", title: "5", template: "<div>#= ( NR5== 0) ? ' ' : kendo.toString(NR5, '') # </div>",
                                    attributes: { 'style': "height:14px;#=leftLabel=='Progress Status'?  ( NR5== null) ? 'background-color:yellow;':( NR5== '0%')? 'background-color:yellow;font-size:2vh;':(NR5=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "NR6", title: "6", template: "<div>#= ( NR6== 0) ? ' ' : kendo.toString(NR6, '') # </div>",
                                    attributes: { 'style': "height:14px;#=leftLabel=='Progress Status'?  ( NR6== null) ? 'background-color:yellow;':( NR6== '0%')? 'background-color:yellow;font-size:2vh;':(NR6=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "NR7", title: "7", template: "<div>#= ( NR7== 0) ? ' ' : kendo.toString(NR7, '') # </div>",
                                    attributes: { 'style': "height:14px;#=leftLabel=='Progress Status'?  ( NR7== null) ? 'background-color:yellow;':( NR7== '0%')? 'background-color:yellow;font-size:2vh;':(NR7=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "NR8", title: "8", template: "<div>#= ( NR8== 0) ? ' ' : kendo.toString(NR8, '') # </div>",
                                    attributes: { 'style': "height:14px;#=leftLabel=='Progress Status'?  ( NR8== null) ? 'background-color:yellow;':( NR8== '0%')? 'background-color:yellow;font-size:2vh;':(NR8=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                            ]
                        },
                        {
                            field: "SZ KR | WA D11K", columns: [
                                {
                                    field: "SZKR1", title: "1", template: "<div>#= ( SZKR1== 0) ? ' ' : kendo.toString(SZKR1, '') # </div>",
                                    attributes: { 'style': "height:14px;#=leftLabel=='Progress Status'?  ( SZKR1== null) ? 'background-color:yellow;':( SZKR1== '0%')? 'background-color:yellow;font-size:2vh;':(SZKR1=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "SZKR2", title: "2", template: "<div>#= ( SZKR2== 0) ? ' ' : kendo.toString(SZKR2, '') # </div>",
                                    attributes: { 'style': "height:14px;#=leftLabel=='Progress Status'?  ( SZKR2== null) ? 'background-color:yellow;':( SZKR2== '0%')? 'background-color:yellow;font-size:2vh;':(SZKR2=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "SZKR3", title: "3", template: "<div>#= ( SZKR3== 0) ? ' ' : kendo.toString(SZKR3, '') # </div>",
                                    attributes: { 'style': "height:14px;#=leftLabel=='Progress Status'?  ( SZKR3== null) ? 'background-color:yellow;':( SZKR3== '0%')? 'background-color:yellow;font-size:2vh;':(SZKR3=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "SZKR4", title: "4", template: "<div>#= ( SZKR4== 0) ? ' ' : kendo.toString(SZKR4, '') # </div>",
                                    attributes: { 'style': "height:14px;#=leftLabel=='Progress Status'?  ( SZKR4== null) ? 'background-color:yellow;':( SZKR4== '0%')? 'background-color:yellow;font-size:2vh;':(SZKR4=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                            ]
                        },
                        {
                            field: "All", columns: [
                                {
                                    field: "WAD1", title: "N1", template: "#= ( WAD1== 0) ? ' ' : kendo.toString(WAD1, '') # </div>",
                                    attributes: { 'style': "height:13px;#=leftLabel=='Progress Status'?  ( WAD1== null) ? 'background-color:yellow;':( WAD1== '0%')? 'background-color:yellow;font-size:2vh;':(WAD1=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "WAD2", title: "S1", template: "#= ( WAD2== 0) ? ' ' : kendo.toString(WAD2, '') # </div>",
                                    attributes: { 'style': "height:13px;#=leftLabel=='Progress Status'?  ( WAD2== null) ? 'background-color:yellow;':( WAD2== '0%')? 'background-color:yellow;font-size:2vh;':(WAD2=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                            ]
                        }
                    ]
                }
            ],
            dataBound: function (e) {

                $("#gridDeliv thead th").css('background-color', '#00bfff');
                $("#gridDeliv thead th").css('color', '#000000');
                $("#gridDeliv thead th").css('font-weight', 'bold');
                const table1 = document.querySelector('#gridDeliv .k-header');
                table1.style = "text-align:center;background-color:#4472C4;color:#ffffff;height:18px;font-size:1.8vh;font-weight:bold;";
                $("#gridDeliv tbody tr").css('height', '13x');
                $("#gridDeliv thead th").css('text-align', 'center');
                $("#gridDeliv thead th").css('vertical-align', 'middle');
                $("#gridDeliv thead tr").css('vertical-align', 'middle');


                const tableH = document.querySelector('#gridDeliv .k-grid-header-wrap table thead');
                //console.log(tableH);
                let headerCell = null; let headerCell2 = null; let headerCell3 = null;
                for (let row of tableH.rows) {
                    const firstCell = row.cells[0];
                    console.log(firstCell.innerText);
                    if (firstCell.innerText == "Cycle") {
                        for (let x = 0; x < 16; x++) {
                            row.cells[x].style = "background-color:#FFC000;text-align:center;font-size:1.9vh;font-weight:bold;";

                        }
                        firstCell.colSpan++; row.cells[1].remove();
                    }
                    else if (firstCell.innerText == "Desc.") {
                        firstCell.colSpan++; row.cells[1].remove();
                    }
                }
                const table = document.querySelector('#gridDeliv .k-grid-content table');
                if (resx > 0) {
                    let headerCell = null;
                    for (let row of table.rows) {
                        const firstCell = row.cells[0];
                        if (firstCell.innerText === 'Time' || firstCell.innerText === 'QTY') {
                            headerCell = firstCell; 
                            headerCell.style = firstCell.innerText === 'Time' ? "background-color:#b6ccf0;" : "background-color:#c4c9af;";
                        } else if (firstCell.innerText === 'Progress Status') {
                            firstCell.colSpan++; row.cells[1].remove();

                        }
                        else {
                            headerCell.rowSpan++;
                            firstCell.remove();
                        }

                    }
                }
            }
        });
        $("#gridPre").kendoGrid({
            //height: 370,
            excel: {
                fileName: "Andon Bufferxlsx",
                allPages: true,
                filterable: true
            },
            dataSource: {
                transport: {
                    read: function (options) {
                        $.ajax({
                            method: 'post',
                            headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
                            url: "@myurl" + 'Andon/AndonPreDelivery',
                            dataType: 'text',
                            data: JSON.stringify({gedung: gedung })
                        }).done(function (data, textStatus, jqXHR) {
                            try {
                                var result = JSON.parse(data);
                                //let tmp1 = result.length > 0 ? result[0].tabGrid : 0;
                                //tabGrid1 = tmp1.toString();
                                resx = result.length;
                            }
                            catch (e) {
                                //swal.fire('Error', 'Error loading grid', 'error');
                                options.success({ data: [] });
                                return;
                            }
                            options.success(result);
                        }).fail(function (jqXHR, textStatus, errorThrown) {
                            //swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
                            options.success({ data: [] });
                        });
                    }
                },
                schema: {
                    model: {
                        id: "PartNumber",
                        fields: {
                            leftLabel: { type: "string" },
                            rightLabel: { type: "string" },
                            NR1: { type: "string" }, NR2: { type: "string" }, NR3: { type: "string" }, NR4: { type: "string" }, NR5: { type: "string" }, NR6: { type: "string" }, NR7: { type: "string" }, NR8: { type: "string" },
                            SZKR1: { type: "string" }, SZKR2: { type: "string" }, SZKR3: { type: "string" }, SZKR4: { type: "string" }, WAD1: { type: "string" }, WAD2: { type: "string" },
                        }
                    }
                },
                //pageSize: 20
            },
            columns: [

                {
                    field: 'PREDELIVERY STATUS', columns: [

                        {
                            title: "Desc.",
                            columns: [{
                                field: "leftLabel", title: "Cycle", template: "<div class='custClass1'> #= leftLabel # </div>", width: 80,
                                // attributes: { 'style': "background-color:LightSteelBlue;border-bottom:solid 1px white;#=leftLabel=='Progress Status'?'font-size:1.4vh':'font-size:1.7vh'#" },
                            }]
                        },
                        {
                            title: "Desc.",
                            columns: [
                        { field: "rightLabel", title: "Blank", template: "<div class='custClass1'> #= (rightLabel == null) ? ' ' : kendo.toString(rightLabel, '') # </div>", width: 80 },]},
                        {
                            field: "NR", columns: [

                                {
                                    field: "NR1", title: "1", template: "<div> #= ( NR1== 0) ? ' ' : kendo.toString(NR1, '') # </div>",
                                    attributes: { 'style': "height:13px;#=leftLabel=='Progress Status'?  ( NR1== null) ? 'background-color:yellow;font-size:2vh;':( NR1== '0%')? 'background-color:yellow;':(NR1=='100%')? 'background-color:Lime;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "NR2", title: "2", template: "<div> #= ( NR2== 0) ? ' ' : kendo.toString(NR2, '') # </div>",
                                    attributes: { 'style': "height:13px;#=leftLabel=='Progress Status'?  ( NR2== null) ? 'background-color:yellow;':( NR2== '0%')? 'background-color:yellow;font-size:2vh;':(NR2=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "NR3", title: "3", template: "<div> #= ( NR3== 0) ? ' ' : kendo.toString(NR3, '') # </div>",
                                    attributes: { 'style': "height:13px;#=leftLabel=='Progress Status'?  ( NR3== null) ? 'background-color:yellow;':( NR3== '0%')? 'background-color:yellow;font-size:2vh;':(NR3=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "NR4", title: "4", template: "<div> #= ( NR4== 0) ? ' ' : kendo.toString(NR4, '') # </div>",
                                    attributes: { 'style': "height:13px;#=leftLabel=='Progress Status'?  ( NR4== null) ? 'background-color:yellow;':( NR4== '0%')? 'background-color:yellow;font-size:2vh;':(NR4=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "NR5", title: "5", template: "<div> #= ( NR5== 0) ? ' ' : kendo.toString(NR5, '') # </div>",
                                    attributes: { 'style': "height:13px;#=leftLabel=='Progress Status'?  ( NR5== null) ? 'background-color:yellow;':( NR5== '0%')? 'background-color:yellow;font-size:2vh;':(NR5=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "NR6", title: "6", template: "<div> #= ( NR6== 0) ? ' ' : kendo.toString(NR6, '') # </div>",
                                    attributes: { 'style': "height:13px;#=leftLabel=='Progress Status'?  ( NR6== null) ? 'background-color:yellow;':( NR6== '0%')? 'background-color:yellow;font-size:2vh;':(NR6=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "NR7", title: "7", template: "<div> #= ( NR7== 0) ? ' ' : kendo.toString(NR7, '') # </div>",
                                    attributes: { 'style': "height:13px;#=leftLabel=='Progress Status'?  ( NR7== null) ? 'background-color:yellow;':( NR7== '0%')? 'background-color:yellow;font-size:2vh;':(NR7=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "NR8", title: "8", template: "<div> #= ( NR8== 0) ? ' ' : kendo.toString(NR8, '') # </div>",
                                    attributes: { 'style': "height:13px;#=leftLabel=='Progress Status'?  ( NR8== null) ? 'background-color:yellow;':( NR8== '0%')? 'background-color:yellow;font-size:2vh;':(NR8=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                            ]
                        },
                        {
                            field: "SZ KR | WA D11K", columns: [
                                {
                                    field: "SZKR1", title: "1", template: "<div> #= ( SZKR1== 0) ? ' ' : kendo.toString(SZKR1, '') # </div>",
                                    attributes: { 'style': "height:13px;#=leftLabel=='Progress Status'?  ( SZKR1== null) ? 'background-color:yellow;':( SZKR1== '0%')? 'background-color:yellow;':(SZKR1=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "SZKR2", title: "2", template: "<div> #= ( SZKR2== 0) ? ' ' : kendo.toString(SZKR2, '') # </div>",
                                    attributes: { 'style': "height:13px;#=leftLabel=='Progress Status'?  ( SZKR2== null) ? 'background-color:yellow;':( SZKR2== '0%')? 'background-color:yellow;font-size:2vh;':(SZKR2=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "SZKR3", title: "3", template: "<div> #= ( SZKR3== 0) ? ' ' : kendo.toString(SZKR3, '') # </div>",
                                    attributes: { 'style': "height:13px;#=leftLabel=='Progress Status'?  ( SZKR3== null) ? 'background-color:yellow;':( SZKR3== '0%')? 'background-color:yellow;font-size:2vh;':(SZKR3=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "SZKR4", title: "4", template: "<div> #= ( SZKR4== 0) ? ' ' : kendo.toString(SZKR4, '') # </div>",
                                    attributes: { 'style': "height:13px;#=leftLabel=='Progress Status'?  ( SZKR4== null) ? 'background-color:yellow;':( SZKR4== '0%')? 'background-color:yellow;font-size:2vh;':(SZKR4=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                            ]
                        },
                        {
                            field: "All", columns: [
                                {
                                    field: "WAD1", title: "N1", template: "<div> #= ( WAD1== 0) ? ' ' : kendo.toString(WAD1, '') # </div>",
                                    attributes: { 'style': "height:13px;#=leftLabel=='Progress Status'?  ( WAD1== null) ? 'background-color:yellow;':( WAD1== '0%')? 'background-color:yellow;font-size:2vh;':(WAD1=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                                {
                                    field: "WAD2", title: "S1", template: "<div> #= ( WAD2== 0) ? ' ' : kendo.toString(WAD2, '') # </div>",
                                    attributes: { 'style': "height:13px;#=leftLabel=='Progress Status'?  ( WAD2== null) ? 'background-color:yellow;':( WAD2== '0%')? 'background-color:yellow;font-size:2vh;':(WAD2=='100%')? 'background-color:Lime;font-size:2vh;':'background-color:red;font-size:2vh;' :''#" },
                                },
                            ]
                        }
                    ]
                }
            ],
            toolbar: $("#template_toolbar").html()
            ,
            dataBound: function (e) {

                $("#BuildingID").kendoDropDownList({
                    template: '<span>#:data.Plant# - #:data.IdValue# - #:data.ViewValue#</span>',
                    valueTemplate: '<span>#:data.Plant# - #:data.IdValue# - #:data.ViewValue#</span>',
                    optionLabel: "select building...",
                    dataValueField: "IdValue",
                    dataSource: {
                        transport: {
                            read: function (options) {
                                $.ajax({
                                    method: 'post',
                                    headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
                                    url: "@myurl" + 'DropDown/INQ',
                                    dataType: 'text',
                                    data: JSON.stringify({ Ftype: "Gedung", Plant: "P3" })
                                }).done(function (data, textStatus, jqXHR) {
                                    try {
                                        var result = JSON.parse(data);
                                    }
                                    catch (e) {
                                        //swal.fire('Error', 'Error loading grid', 'error');
                                        options.success({ data: [] });
                                        return;
                                    }
                                    options.success(result);
                                }).fail(function (jqXHR, textStatus, errorThrown) {
                                    //swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
                                    options.success({ data: [] });
                                });
                            }
                        }
                    },
                    change: function (e) {
                        var value = this.value();
                        value = value == null ? '' : value;
                        if (value != '') {
                            localStorage['gedungP3'] = value;
                        }
                        intr = 0; change = 0;
                        // Use the value of the widget
                    }
                }).data("kendoDropDownList");
                gedung = localStorage['gedungP3'] != undefined ? localStorage['gedungP3'] : gedung;
                $("#BuildingID").data("kendoDropDownList").value(gedung);
                $("#hari").html(hari);
                $("#tanggal").html(tanggal);
                $("#jamx").html('&nbsp;' + jam);
                $(".AndonHeader").css('background-color', '#42f5bf');
                $("#GridTittle").html("Andon Monitoring Delivery");

                $("#gridPre tbody tr").css('height', '14px');

                $("#gridPre thead th").css('background-color', '#00bfff');
                $("#gridPre thead th").css('color', '#000000');
                $("#gridPre thead th").css('font-weight', 'bold');
                $("#gridPre thead th").css('text-align', 'center');
                $("#gridPre thead th").css('vertical-align', 'middle');
                $("#gridPre thead tr").css('vertical-align', 'middle');
                const table1 = document.querySelector('#gridPre .k-header');
                table1.style = "text-align:center;background-color:#4472C4;color:#ffffff;height:18px;font-size:1.8vh;font-weight:bold;";

                const tableH = document.querySelector('#gridPre .k-grid-header-wrap table thead');
                //console.log(tableH);
                let headerCell = null; let headerCell2 = null; let headerCell3 = null;
                for (let row of tableH.rows) {
                    const firstCell = row.cells[0];
                    console.log(firstCell.innerText);
                    if (firstCell.innerText == "Cycle") {
                        for (let x = 0; x < 16; x++) {
                            row.cells[x].style = "background-color:#FFC000;text-align:center;font-size:1.9vh;font-weight:bold;"; 

                        }
                        firstCell.colSpan++; row.cells[1].remove();
                    } 
                    else if (firstCell.innerText == "Desc."){
                        firstCell.colSpan++; row.cells[1].remove();
                    }
                }

                const table = document.querySelector('#gridPre .k-grid-content table');
                if (resx > 0) {
                let headerCell = null;
                    for (let row of table.rows) {
                        const firstCell = row.cells[0];
                        if (firstCell.innerText === 'Time' || firstCell.innerText === 'QTY') {
                            headerCell = firstCell;
                            headerCell.style = firstCell.innerText === 'Time' ? "background-color:#b6ccf0;" : "background-color:#c4c9af;";
                        } else if (firstCell.innerText === 'Progress Status') {
                            firstCell.colSpan++; row.cells[1].remove();

                        }
                        else {
                            headerCell.rowSpan++;
                            firstCell.remove();
                        }

                    }
                }
            }
        });

    }
    function isiGrid1() {
        $("#gridPre").html("");
        $("#GridPairDet").html("");
        $("#GridPairDet").kendoGrid({
            excel: {
                fileName: "Andon Bufferxlsx",
                allPages: true,
                filterable: true
            },
            dataSource: {
                transport: {
                    read: function (options) {
                        $.ajax({
                            method: 'post',
                            headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
                            url: "@myurl" + 'Andon/AndonPairingKanbanList',
                            dataType: 'text',
                            data: JSON.stringify({gedung: gedung })
                        }).done(function (data, textStatus, jqXHR) {
                            try {
                                var result = JSON.parse(data);
                                resx = result.length;
                                //console.log(data);
                            }
                            catch (e) {
                                //swal.fire('Error', 'Error loading grid', 'error');
                                options.success({ data: [] });
                                return; 
                            }
                            options.success(result);
                        }).fail(function (jqXHR, textStatus, errorThrown) {
                            //swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
                            options.success({ data: [] });
                        });
                    }
                },
                schema: {
                    model: {
                        id: "MaterialNo",
                        fields: {
                            Nos: { type: "string" },
                            KanbanId: { type: "string" },
                            Cycle: { type: "string" },
                            PartName: { type: "string" },
                            PartQty: { type: "string" },
                            PairingStatus: { type: "string" }
                        }
                    }
                }
            },
            columns: [
                {
                    field: 'Nos',
                    title: 'No.',
                    width: 30,
                    template: "<div class='customClass1'> #= (Nos == null) ? ' ' : kendo.toString(Nos, '') # </div>",
                },
                { title: "Kanban ID", columns: [
                {
                    field: "",
                    title: "",
                    width: 80,
                    template: "<div class='customClass1'> #= (KanbanId == null) ? ' ' : kendo.toString(KanbanId, '') # </div>",
                },
                {
                    field: "",
                    title: "",
                    width: 80,
                    template: "<div class='customClass1'> #= (Cycle == null) ? ' ' : kendo.toString(Cycle, '') # </div>",
                        },]
                },
                {
                    field: "PartName",
                    title: "PART NAME",
                    width: 140,
                    template: "<div class='customClass1'> #= (PartName == null) ? ' ' : kendo.toString(PartName, '') # </div>",
                },
                {
                    field: "PartQty",
                    title: "QTY (PC)",
                    width: 80,
                    template: "<div class='customClass2'> #= (PartQty == null) ? ' ' : kendo.toString(PartQty, '') # </div>",
                },
                {
                    field: "PairingStatus",
                    title: "STATUS",
                    width: 110,
                    template: "<div class='customClass2'> #= (PairingStatus == null) ? ' ' : kendo.toString(PairingStatus, '') # </div>",

                },

            ]
            ,
            dataBound: function (e) {

                //$("#hari").html("");
                //$("#tanggal").html("");
                //$("#shift").html("");
                //$("#jam").html("");

                $("#GridPairDet tbody tr").css('height', '50px');
                $("#GridPairDet tbody tr").css('font-size', '30px');
                $("#GridPairDet tbody th").css('font-size', '16px');
                $("#GridPairDet tbody th").css('font-weight', 'bold');
                $("#GridPairDet thead th").css('background-color', '#154c79');
                $("#GridPairDet thead th").css('color', '#ffffff');
                $("#GridPairDet thead th").css('text-align', 'center');
                $("#GridPairDet thead th").css('vertical-align', 'middle');
                $("#GridPairDet thead tr").css('vertical-align', 'middle');


                //const table1 = document.querySelector('#GridPairDet th');
                //table1.style = "text-align:center;background-color:#000;color:#fff;height:20px;font-size:14px;";
                const table = document.querySelector('#GridPairDet .k-grid-content table');
                let headerCell = null;
                let headerCell2 = null;
                let headerCell3 = null;
                let cnt = 0;let stat=''; let color="";
                if (resx >0){
                    for (let row of table.rows) {

                        const secondCell = row.cells[4];
                        const thirdCell = row.cells[5];
                        const cell1 = row.cells[0];

                        stat = thirdCell.innerText.length > 1? thirdCell.innerText:stat;
                        if (secondCell.innerText != '' && secondCell.innerText != null) {
                            headerCell2 = secondCell; headerCell = cell1;
                            headerCell3 = thirdCell;
                            //row.cells[0].style = " border-bottom: 3px solid #000;backgroun-color:#fff;";
                            row.cells[1].style = " border-bottom: 3px solid #000;backgroun-color:#fff;";
                            row.cells[2].style = " border-bottom: 3px solid #000;backgroun-color:#fff;";
                            row.cells[3].style = " border-bottom: 3px solid #000;backgroun-color:#fff;";
                        }
                        else {
                            headerCell2.rowSpan++;
                            headerCell3.rowSpan++; headerCell.rowSpan++;
                            color = stat == "SUCCESS" ? "0f0;" : "f00;";
                            cell1.remove(); secondCell.remove();
                            thirdCell.remove();
                            headerCell2.style = " border-bottom: 3px solid #000;border-left: 3px solid #000;background-color:#" + color;
                            headerCell3.style = " border-bottom: 3px solid #000;border-left: 3px solid #000;background-color:#" + color;

                            row.cells[0].style = " border-bottom: 3px solid #000;backgroun-color:#fff;";
                            headerCell.style = " border-bottom: 3px solid #000;backgroun-color:#fff;";
                            row.cells[1].style = " border-bottom: 3px solid #000;backgroun-color:#fff;";
                            row.cells[2].style = " border-bottom: 3px solid #000;backgroun-color:#fff;";
                            //row.cells[3].style = " border-bottom: 3px solid #000;backgroun-color:#fff;";

                        }
                        cnt++;

                    }
                }
            }
        });
        $("#gridPre").kendoGrid({
            //height: 235,
            excel: {
                fileName: "Andon Bufferxlsx",
                allPages: true,
                filterable: true
            },
            dataSource: {
                transport: {
                    read: function (options) {
                        $.ajax({
                            method: 'post',
                            headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
                            url: "@myurl" + 'Andon/AndonPairingKanbanHeader',
                            dataType: 'text',
                            data: JSON.stringify({gedung: gedung })
                        }).done(function (data, textStatus, jqXHR) {
                            try {
                                var result = JSON.parse(data);
                                resx = result.length;
                            }
                            catch (e) {
                                //swal.fire('Error', 'Error loading grid', 'error');
                                options.success({ data: [] });
                                return;
                            }
                            options.success(result);
                        }).fail(function (jqXHR, textStatus, errorThrown) {
                            //swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
                            options.success({ data: [] });
                        });
                    }
                },
                schema: {
                    model: {
                        id: "KanbanId",
                        fields: {
                            labels: { type: "string" },
                            KanbanId: { type: "string" },
                            PartName: { type: "string" },
                            PartQty: { type: "string" },
                            PairingStatus: { type: "string" },
                            Arrow: { type: "string" },

                        }
                    }
                }
            },
            columns: [
                {
                    title: "Validasi Predelivery", columns: [
                        {
                            title: "Kanban ID", columns: [{
                                field: "",
                                title: "",
                                width: 60,
                                template: "<div class='custom1'> #= (labels == null) ? ' ' : kendo.toString(labels, '') #</div>",
                            },

                            {
                                field: "",
                                title: "",
                                width: 100,
                                template: "<div class='custom1'> #= (KanbanId == null) ? ' ' : kendo.toString(KanbanId, '') #</div>",
                            },]
                        },
                        {
                            field: "Arrow",
                            title: "",
                            width: 25,
                            template: "<div class='customArrow'>#= (Arrow == null) ? ' ' : kendo.toString(Arrow, '') #</div>",

                        },
                        {
                            field: "PartName",
                            title: "PART NAME",
                            width: 200,
                            template: "<div class='customClass2'> #= (PartName == null) ? ' ' : kendo.toString(PartName, '') # </div>",
                        },
                        {
                            field: "PartQty",
                            title: "QTY (PC)",
                            width: 60,
                            template: "<div class='customQty'> #= (PartQty == null) ? ' ' : kendo.toString(PartQty, '') # </div>",
                            attributes: { 'style': "#=PairingStatus=='FAILED'?'background-color: red;':'background-color: Lime;font-size:20px;'#" },
                        },
                        {
                            field: "PairingStatus",
                            title: "STATUS",
                            width: 60,
                            //template: "<div class='customClass1'> #= (PairingStatus == null) ? '' : kendo.toString(PairingStatus, '') # </div>",
                            template: "<div class='customClass3'>  <div class='sym'> #= (PairingStatus == 'FAILED') ? '<b>X</b><br>': '✓' #</div> <div  class='stat'>#=kendo.toString(PairingStatus, '')#</div></div>",
                            attributes: { 'style': "#=PairingStatus=='FAILED'?'background-color: red;':'background-color: Lime;font-size:20px;'#" },
                        },
                    ]
                }

            ],
            toolbar: $("#template_toolbar").html()
            ,
            dataBound: function (e) {
                $("#hari").html(hari);
                $("#tanggal").html(tanggal);
                $("#jamx").html('&nbsp;' + jam);

                $("#gridPre tbody tr").css('height', '50px');
                $("#gridPre thead th").css('background-color', '#154c79');
                $("#gridPre thead th").css('color', '#ffffff');
                $("#gridPre thead th").css('font-weight', 'bold');
                $("#gridPre thead th").css('text-align', 'center');
                $("#gridPre thead th").css('vertical-align', 'middle');
                $("#gridPre thead tr").css('vertical-align', 'middle');

                $("#gridPre").css('padding-bottom', '2px');
                //$(".AndonHeader").css('background-color', '#6C9BCF');
                $("#GridTittle").html("Andon Status Pairing");


                document.querySelector('#gridPre .k-header').style = "text-align:center;background-color:#000;color:#fff;height:20px;font-size:14px;";
                const table = document.querySelector('#gridPre .k-grid-content table');
                let headerCell = '';
                let headerCell2 = '';
                let headerCell3 = '';
                let cnt = 0;

                //console.log(table.rows);
                if (resx > 0) {
                    for (let row of table.rows) {

                        //console.log(row.cells[3].innerText + '$' . row.cells[3].innerText));

                        const firstCell = row.cells[3];
                        const secondCell = row.cells[4];
                        const thirdCell = row.cells[5];


                        if (firstCell.innerText != '' && firstCell.innerText != null) {
                            headerCell = firstCell;
                            headerCell2 = secondCell;
                            headerCell3 = thirdCell;
                        }
                        else {
                            headerCell.rowSpan++;
                            headerCell2.rowSpan++;
                            headerCell3.rowSpan++;

                            firstCell.remove();
                            secondCell.remove();
                            thirdCell.remove();
                        }
                        cnt++;

                    }
                }

                $("#BuildingID").kendoDropDownList({
                    template: '<span>#:data.Plant# - #:data.IdValue# - #:data.ViewValue#</span>',
                    valueTemplate: '<span>#:data.Plant# - #:data.IdValue# - #:data.ViewValue#</span>',
                    optionLabel: "select building...",
                    dataValueField: "IdValue",
                    dataSource: {
                        transport: {
                            read: function (options) {
                                $.ajax({
                                    method: 'post',
                                    headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
                                    url: "@myurl" + 'DropDown/INQ',
                                    dataType: 'text',
                                    data: JSON.stringify({ Ftype: "Gedung", Plant: "P3" })
                                }).done(function (data, textStatus, jqXHR) {
                                    try {
                                        var result = JSON.parse(data);
                                    }
                                    catch (e) {
                                        //swal.fire('Error', 'Error loading grid', 'error');
                                        options.success({ data: [] });
                                        return;
                                    }
                                    options.success(result);
                                }).fail(function (jqXHR, textStatus, errorThrown) {
                                    //swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
                                    options.success({ data: [] });
                                });
                            }
                        }
                    },
                    change: function (e) {
                        var value = this.value();
                        value = value == null ? '' : value;
                        if (value != '') {
                            localStorage['gedungP3'] = value;
                        }
                        intr = 0; change = 0;
                        // Use the value of the widget
                    }
                }).data("kendoDropDownList");
                gedung = localStorage['gedungP3'] != undefined ? localStorage['gedungP3'] : gedung;
                $("#BuildingID").data("kendoDropDownList").value(gedung);
            }
        });

    }
    $(document).ready(function () {
        var intervalDate = setInterval(function () {
            d = new Date();
            hari = days[d.getDay()];
            bulan = months[d.getMonth()];
            tahun = d.getFullYear();
            tanggal = d.getDate() + " " + bulan + " " + tahun;

            hour = d.getHours();
            hour = hour > 9 ? hour : '0' + hour;
            minute = d.getMinutes();
            minute = minute > 9 ? minute : '0' + minute;
            jam = hour + ':' + minute;
          
            if (intr % 15 == 0) {
                if(change == 1){
                    isiGrid2(); change = 0;
                    $("#gridDeliv").hide();
                }else{
                    isiGrid(); change = 1;
                        $("#gridDeliv").show();
                }
                //$("#gridPre").show();
                $("#GridPair").hide();
                $("#GridPairDet").hide();

                $.ajax({
                    method: 'post',
                    headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
                    url: "@myurl" + 'Andon/Shift',
                    dataType: 'text',
                    data: JSON.stringify({ Plant: 'P3' })
                }).done(function (data, textStatus, jqXHR) {
                    try {
                        var result = JSON.parse(data);
                        //console.log(result[0].shift);
                        shift = result[0].shift;
                    }
                    catch (e) {
                        //swal.fire('Error', 'Error loading grid', 'error');

                        return;
                    }
                }).fail(function (jqXHR, textStatus, errorThrown) {
                    //swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');

                });

                $("#shift").html(shift);
            } else if (intr > 0) {
                $.ajax({
                    method: 'post',
                    headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
                    url: "@myurl" + 'Andon/AndonPairingCek',
                    dataType: 'text',
                    data: JSON.stringify({ param: 'Predelivery', gedung: gedung })
                }).done(function (data, textStatus, jqXHR) {
                    try {
                        if (data != "[]") {
                            let jsn = JSON.parse(data);
                            if (preID != jsn[0]['PalletId']){
                                preID = jsn[0]['PalletId'];
                                isiGrid1();
                                $("#GridPairDet").show();
                                $("#gridDeliv").hide();
                                intr = 1;

                            }

                        }
                    }
                    catch (e) {
                        //swal.fire('Error', 'Error loading grid', 'error');
                        return;
                    }
                }).fail(function (jqXHR, textStatus, errorThrown) {
                    //swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
                });
            }
            intr++;
        }, 1000);
    });
</script>

<script type="text/x-kendo-template" id="template_toolbar">

    <div id="Build">
             <input type="text" id="BuildingID" style="width:200px;" /></div>
    <div class="toolbar AndonHeader">
          <div style="width:10vw;">
           <img src="../../img/icon1.png" height="67px"/>
         </div>
         <div style="width:65vw;font-weight:bold;" id="GridTittle">Andon Monitoring Delivery</div>
         <div style="width:25vw;border-left:solid 1px;">
             <table id="tbHead" >
                 <tr>
                     <td style="font-weight:bold;font-size:2vh;text-align:center;margin-top:0px;margin-top:0px;" id="hari"></td>
                     <td style="font-weight:bold;font-size:2vh;text-align:center;margin-top:0px;margin-bottom:0px;" id="shift"></td>
                 </tr>
                 <tr>
                     <td style="font-weight:bold;font-size:2vh;text-align:center;margin-top:0px;margin-top:0px;" id="tanggal"></td>
                     <td style="font-weight:bold;font-size:2vh;text-align:center;margin-top:0px;margin-bottom:0px;" id="jamx"></td>
                 </tr>

             </table>
        </div>
    </div>
</script>
