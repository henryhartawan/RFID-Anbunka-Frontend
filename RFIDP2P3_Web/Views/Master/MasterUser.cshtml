@{
	ViewData["Title"] = "Master User";
	string myurl = new ConfigurationBuilder().AddJsonFile("appsettings.json").Build().GetSection("Path:URL").Value;
}

<style>
	.k-dropdown-wrap .k-input, .k-numeric-wrap .k-input, .k-picker-wrap .k-input {
		height: 30px;
	}
</style>

<div class="page-main">
	<div class="page-content padding-5">
		<div id="grid" style="margin-top:5px; margin-bottom:5px;"></div>
	</div>
</div>

<div class="modal fade modal-primary" id="editor" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h4 class="modal-title" id="myModalTitle">Master User</h4>
			</div>
			<div class="modal-body margin-bottom-0 padding-bottom-0">
				<div class="panel">
					<div class="panel-body">
						<form class="form-horizontal">
							<div class="col-md-6">
								<div class="form-group form-material col-md-12">
									<label class="col-sm-3 control-label">User ID</label>
									<div class="col-sm-9">
										<input type="text" class="form-control" id="User_Id" />
									</div>
								</div>
								<div class="form-group form-material col-md-12">
									<label class="col-sm-3 control-label">Password</label>
									<div class="col-sm-9">
										<input type="password" class="form-control" id="Password" onkeyup="checkVal()" />
									</div>
								</div>
								<div class="form-group form-material col-md-12">
									<label class="col-sm-3 control-label">Plant</label>
									<div class="col-sm-9">
										<input type="text" class="" id="PlantID" style="width:100%" />
									</div>
								</div>
								<div class="form-group form-material col-md-12">
									<label class="col-sm-3 control-label">Department</label>
									<div class="col-sm-9">
										<input type="text" class="" id="DeptId" style="width:100%" />
									</div>
								</div>
								<div class="form-group form-material col-md-12" id="divSupp">
									<label class="col-sm-3 control-label">Supplier Code</label>
									<div class="col-sm-9">
										<input type="text" class="" id="SupplierCode" style="width:100%" />
									</div>
								</div>
								<div class="form-group form-material col-md-12" id="fg-email">
									<label class="col-sm-3 control-label">Email</label>
									<div class="col-sm-9">
										<input type="email" class="form-control" id="Email" style="width:100%" onkeyup="checkVal()"/>
										<span class="help-block" id="err-email" style="display: none;">Format email tidak valid</span>
									</div>
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-group form-material col-md-12">
									<label class="col-sm-3 control-label">Name</label>
									<div class="col-sm-9">
										<input type="text" class="form-control" id="Name" />
									</div>
								</div>
								<div class="form-group form-material col-md-12">
									<label class="col-sm-3 control-label">User Group</label>
									<div class="col-sm-9">
										<input type="text" class="" id="UserGroup_Id" style="width:100%" required />
									</div>
								</div>
								<div class="form-group form-material col-md-12">
									<label class="col-sm-3 control-label">Building</label>
									<div class="col-sm-9">
										<input type="text" class="" id="BuildingId" style="width:100%" />
									</div>
								</div>
								<div class="form-group form-material col-md-12">
									<label class="col-sm-3 control-label">Section</label>
									<div class="col-sm-9">
										<input type="text" class="" id="SectionId" style="width:100%" />
									</div>
								</div>
								<div class="form-group form-material col-md-12">
									<label class="col-sm-3 control-label">Require MFA</label>
									<div class="col-sm-9">
										<div class="checkbox checkbox-styled checkbox-primary">
											<label>
												<input type="checkbox" id="RequireMfa" checked><span></span>
												Yes
											</label>
										</div>
									</div>
								</div>
							</div>
							<div>
								<label class="col-sm-12" id="valid" style="color:red;font-weight:bold;"></label>
							</div>
							<div class="clearfix"></div>
						</form>
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal" id='clear'>Close</button>
				<button type="button" class="btn btn-primary" id="btnSave">Submit</button>
			</div>
		</div>
	</div>
</div>

<script>
	var IUType = 'I';
	function checkVal() {
		var errormsg = '';
		var Password = $("#Password").val();
		
		if (Password != '') {
			const pattern1 = /[A-Z]/;
			const pattern2 = /[a-z]/;
			const pattern3 = /[0-9]/;
			const pattern4 = /[`!@@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~]/;
			var len = Password.length;

			if (len < 8) errormsg += '<br/>Password must be at least 8 characters';
			if (!pattern1.test(Password)) errormsg += '<br/>Password must contain upper case';
			if (!pattern2.test(Password)) errormsg += '<br/>Password must contain lower case';
			if (!pattern3.test(Password)) errormsg += '<br/>Password must contain number';
			if (!pattern4.test(Password)) errormsg += '<br/>Password must contain symbol';
		}

		if (errormsg != '') {
			document.getElementById("valid").innerHTML = errormsg;
			document.getElementById("btnSave").disabled = true;
		} else {
			document.getElementById("valid").innerHTML = "";
			document.getElementById("btnSave").disabled = false;
		}

		//validasi email
		var Email = $("#Email").val();

		var isEmailValid = true;
		if (Email != '') {
			const emailPattern = /^[^\s@@]+@@[^\s@@]+\.[^\s@@]+$/;
			if (!emailPattern.test(Email)) {
				isEmailValid = false;
				$("#fg-email").addClass("has-error");
				$("#err-email").show();
			} else {
				$("#fg-email").removeClass("has-error");
				$("#err-email").hide();
			}
		} else {
			$("#fg-email").removeClass("has-error");
			$("#err-email").hide();
		}
	}

	var AppD = {
		attachEvents: function () {
			var o = this;
			o.dom.$btnSave.on('click', o.eventHandlers.onClickBtnSave.bind(o));

			o.dom.$grid.on('click', '#btnCreate', o.eventHandlers.onClickBtnCreate.bind(o));
			o.dom.$grid.on('click', '#btnExcel', o.eventHandlers.onClickBtnExcel.bind(o));

			o.dom.$grid.on('click', '.btnUpdate', o.eventHandlers.onClickBtnUpdate.bind(o));
			o.dom.$grid.on('click', '.btnDelete', o.eventHandlers.onClickBtnDelete.bind(o));
		},
		cacheDom: function () {
			var o = this;
			o.dom.$editor = $("#editor");
			o.dom.$grid = $("#grid");
			o.dom.inputs = {};
			o.dom.inputs.$inputUserID = $("#User_Id");
			o.dom.inputs.$inputName = $("#Name");
			o.dom.inputs.$inputPassword = $("#Password");
			o.dom.inputs.$inputUserGroup = $("#UserGroup_Id");
			o.dom.inputs.$inputPlantID = $("#PlantID");
			o.dom.inputs.$inputBuildingId = $("#BuildingId");
			o.dom.inputs.$inputDeptId = $("#DeptId");
			o.dom.inputs.$inputSectionId = $("#SectionId");
			o.dom.inputs.$inputSupplier= $("#SupplierCode");
			o.dom.inputs.$inputEmail= $("#Email");
			o.dom.inputs.$RequireMfa = $("#RequireMfa");
			o.dom.$btnSave = $("#btnSave");
		},
		data: {},
		dom: {},
		eventHandlers: {
			onClickBtnCreate: function () {
				var o = this;
				IUType = 'I';
				o.dom.inputs.$inputUserID.val('');
				o.dom.inputs.$inputName.val('');
				o.dom.inputs.$inputPassword.val('');
				o.dom.inputs.$inputEmail.val('');
				o.dom.inputs.$inputUserGroup.data("kendoComboBox").value('');
				o.dom.inputs.$inputPlantID.data("kendoDropDownList").value('');
				o.dom.inputs.$inputBuildingId.data("kendoDropDownList").value('');
				o.dom.inputs.$inputDeptId.data("kendoComboBox").value('');
				o.dom.inputs.$inputSectionId.data("kendoComboBox").value('');
				o.dom.inputs.$inputSupplier.data("kendoComboBox").value('');

				o.dom.inputs.$RequireMfa.prop('checked', true);
                document.getElementById("User_Id").disabled = false;
				$("#Password").attr("placeholder", "");

				$("#divSupp").hide();
				o.dom.$editor.modal('show');
			},
			onClickBtnDelete: function (e) {
				var o = this;
				var di = o.dom.$grid.data('kendoGrid').dataItem($(e.target).closest('tr'));

				swal.fire({
					title: 'Delete?',
					text: "You won't be able to revert this!",
					icon: 'warning',
					showCancelButton: true,
					confirmButtonText: 'Yes'
				}).then((result) => {
					if (result.isConfirmed) {
						$.ajax({
							method: 'post',
							headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
							url: "@myurl"+'MasterUser/DEL',
							dataType: 'text',
							data: JSON.stringify({
								PIC_ID: di.PIC_ID,
                                UserLogin: "@Context.Session.GetString("PIC_ID")"
							})
						}).done(function (data, textStatus, jqXHR) {
							if (data !== 'success') {
								swal.fire('', data, 'error');
								return;
							}
							swal.fire({ title: 'Success', text: 'Data deleted', icon: 'success', timer: 2000, showConfirmButton: false });
						}).fail(function (jqXHR, textStatus, errorThrown) {
							swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
						}).always(function (data_or_jqXHR, textStatus, jqXHR_or_errorThrown) {
							o.dom.$grid.data('kendoGrid').dataSource.read();
						});
					}
				});
			},
			onClickBtnExcel: function () {
				var o = this;
				o.dom.$grid.data('kendoGrid').saveAsExcel();
			},
			onClickBtnUpdate: function (e) {
				var o = this;
				IUType = 'U';
				var di = o.dom.$grid.data('kendoGrid').dataItem($(e.target).closest('tr'));

				o.dom.inputs.$inputUserID.val(di.PIC_ID);
				o.dom.inputs.$inputName.val(di.PIC_Name);
				o.dom.inputs.$inputEmail.val(di.Email);
				o.dom.inputs.$inputPassword.val('');
				o.dom.inputs.$inputUserGroup.data("kendoComboBox").value(di.UserGroup_Id);
				o.dom.inputs.$inputPlantID.data("kendoDropDownList").value(di.PlantID);
				o.dom.inputs.$inputBuildingId.data("kendoDropDownList").value(di.BuildingId);
				o.dom.inputs.$inputDeptId.data("kendoComboBox").value(di.DeptId);
				o.dom.inputs.$inputSectionId.data("kendoComboBox").value(di.SectionId);
				o.dom.inputs.$inputSupplier.data("kendoComboBox").value(di.SupplierCode);

				o.dom.inputs.$RequireMfa.prop('checked', di.RequireMfa === true);

                document.getElementById("User_Id").disabled = true;
				$("#Password").attr("placeholder", "Leave this blank to keep password");

				if(di.UserGroup_Id == '024' || di.UserGroup_Id == '025') {
					$("#divSupp").show();
				} else {
					$("#divSupp").hide();
				}

				o.dom.$editor.modal('show');
			},
			onClickBtnSave: function (e) {
				var o = this;
				var UID = $("#User_Id").val();
				var Name = $("#Name").val();
				var Password = $("#Password").val();
				var Email = $("#Email").val();
				var UserGroup = $("#UserGroup_Id").data("kendoComboBox").value();
				var PlantID = $("#PlantID").data("kendoDropDownList").value();
				var BuildingId = $("#BuildingId").data("kendoDropDownList").value();
				var DeptId = $("#DeptId").data("kendoComboBox").value();
				var SectionId = $("#SectionId").data("kendoComboBox").value();
				var Supplier = $("#SupplierCode").data("kendoComboBox").value();

				var RequireMfa = o.dom.inputs.$RequireMfa.prop('checked');

				var allowedEmptyLocationGroups = ['001', '002', '024', '025', '026'];

				if (UID == '' || Name == '' || UserGroup == '' || (IUType == 'I' && Password == '') ||
				  (!allowedEmptyLocationGroups.includes(UserGroup) &&
					(PlantID == '' || BuildingId == '' || DeptId == '' || SectionId == '')) ||
				  ((UserGroup == '024' || UserGroup == '025') && Supplier == '' && Email == '')
				) {
					swal.fire({ title: 'Warning', text: 'Please fill all fields', icon: 'warning' });
				} else {
					swal.fire({
						title: "Save?",
						icon: 'warning',
						showCancelButton: true,
						confirmButtonText: 'Yes'
					}).then((result) => {
						if (result.isConfirmed) {
							$.ajax({
								method: 'post',
								headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
								url: "@myurl" + 'MasterUser/INS',
								dataType: 'text',
								data: JSON.stringify({
									PIC_ID: UID,
									PIC_Name: Name,
									password: Password,
									Email: Email,
									UserGroup_Id: UserGroup,
									PlantID: PlantID,
									DeptId: DeptId,
									SectionId: SectionId,
									BuildingId: BuildingId,
									SupplierCode: Supplier,
									IUType: IUType,
									RequireMfa: RequireMfa,
									UserLogin: "@Context.Session.GetString("PIC_ID")"
								})
							}).done(function (data, textStatus, jqXHR) {
								if (data !== 'success') {
									swal.fire('Error', data, 'error');
									return;
								}
								o.dom.$editor.modal('hide');
								swal.fire({ title: 'Success', text: 'Data saved', icon: 'success', timer: 2000, showConfirmButton: false });
							}).fail(function (jqXHR, textStatus, errorThrown) {
								swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
							}).always(function (data_or_jqXHR, textStatus, jqXHR_or_errorThrown) {
								o.dom.$grid.data('kendoGrid').dataSource.read();
							});
						}
					});
				}
			}
		},
		init: function () {
			var o = this;
			o.cacheDom();
			o.attachEvents();
			o.initElements();
		},
		initElements: function () {
			var o = this;

			o.dom.$grid.kendoGrid({
				excel: {
					fileName: "Master User.xlsx",
					allPages: true,
					filterable: true
				},
				dataSource: {
					transport: {
						read: function (options) {
							$.ajax({
								method: 'post',
								headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
								url: "@myurl"+'MasterUser/INQ',
								dataType: 'text',
								data: JSON.stringify({
									UserLogin: "@Context.Session.GetString("PIC_ID")"
								})
							}).done(function (data, textStatus, jqXHR) {
								try {
									var result = JSON.parse(data);
								}
								catch (e) {
									swal.fire('Error', 'Error loading grid', 'error');
									options.success({ data: [] });
									return;
								}
								options.success(result);
							}).fail(function (jqXHR, textStatus, errorThrown) {
								swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
								options.success({ data: [] });
							});
						}
					},
					schema: {
						model: {
							id: "PIC_ID",
							fields: {
								PIC_ID: { type: "string" },
								PIC_Name: { type: "string" },
								UserGroup_Id: { type: "string" },
								UserGroup: { type: "string" },
								PlantID: { type: "string" },
								DeptId: { type: "string" },
								SectionId: { type: "string" },
								BuildingId: { type: "string" },
								PlantName: { type: "string" },
								DeptName: { type: "string" },
								SectionName: { type: "string" },
								BuildingName: { type: "string" },
								Supplier: { type: "string" },
								Email: { type: "string" },
								RequireMfa: { type: "boolean" }
							}
						}
					},
					pageSize: 20
				},
				scrollable: true,
				sortable: true,
				resizable: true,
				reorderable: true,
				filterable: {
					extra: false,
					operators: {
						string: {
							contains: "Contains",
							eq: "Equal to",
							neq: "Not equal to"
						}
					}
				},
				pageable: {
					refresh: true,
					input: true,
					numeric: true,
					pageSizes: true,
					buttonCount: 5
				},
				columns: [
                @if(Context.Session.GetString("edit_master_user") == "True")
                {
                    <text>
                    {
                        width: 50,
                        command: [{
							name: "Update",
							text: "<i class='fa fa-pencil-square-o btnUpdate' style='font-size:18px;color:#737373;'></i>"
                        }]
                    },
                    </text>
                }
				@if (Context.Session.GetString("del_master_user") == "True")
                {
                    <text>
                    {
                        width: 50,
                        command: [{
							name: "Delete",
							text: "<i class='fa fa-trash-o btnDelete' style='font-size:18px;color:#800000;'></i>"
                        }]
                    },
                    </text>
                }
				{
					field: "PIC_ID",
					title: "ID",
					width: 100
				},
				{
					field: "PIC_Name",
					title: "Name",
					width: 200
				},
				{
					field: "UserGroup_Id",
					title: "User Group ID",
					width: 100,
					hidden: true
				},
				{
					field: "UserGroup",
					title: "User Group",
					width: 100
				},
				{
					field: "PlantID",
					title: "Plant",
					width: 60
				},
				{
					field: "DeptName",
					title: "Dept",
					width: 150,
					template: "<div class='customClass'> #= (DeptName == null) ? ' ' : kendo.toString(DeptName, '') # </div>",
				},
				{
					field: "SectionName",
					title: "Section",
					width: 150,
					template: "<div class='customClass'> #= (SectionName == null) ? ' ' : kendo.toString(SectionName, '') # </div>",
				},
				{
					field: "BuildingName",
					title: "Gedung",
					width: 100
				},
				{
					field: "Supplier",
					title: "Supplier",
					width: 150,
					template: "<div class='customClass'> #= (Supplier == null) ? ' ' : kendo.toString(Supplier, '') # </div>",
				},
				{
					field: "Email",
					title: "Email",
					width: 150,
					template: "<div class='customClass'> #= (Email == null) ? ' ' : kendo.toString(Email, '') # </div>",
				},
				{
					field: "RequireMfa",
					title: "MFA",
					template: "<div class='customClass'> #= RequireMfa ? 'Yes' : 'No' # </div>",
					width: 100,
					hidden: true,
				}],
				toolbar: $("#template_toolbar").html()
			});

			$("#UserGroup_Id").kendoComboBox({
				dataValueField: "UserGroup_Id",
				dataTextField: "UserGroup",
				filter: 'contains',
				dataSource: {
					transport: {
						read: function (options) {
							$.ajax({
								method: 'post',
								headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
								url: "@myurl"+'MasterUserGroup/INQ',
								dataType: 'text',
								data: JSON.stringify({ UserGroup_Id: "@Context.Session.GetString("UserGroup_Id")" })
							}).done(function (data, textStatus, jqXHR) {
								try {
									var result = JSON.parse(data);
								}
								catch (e) {
									swal.fire('Error', 'Error loading grid', 'error');
									options.success({ data: [] });
									return;
								}
								options.success(result);
							}).fail(function (jqXHR, textStatus, errorThrown) {
								swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
								options.success({ data: [] });
							});
						}
					}
				},
				change: function (e) {
					if (this.value() && this.selectedIndex == -1) {
						this._filterSource({
							value: this.value(),
							field: this.options.dataTextField,
							operator: "contains"
						});
						this.select(0);
						if (this.selectedIndex == -1) {
							this.text("");
							this.value("");
						}
					}

					if(this.value() == '024' || this.value() == '025') {
						$("#divSupp").show();
					} else {
						$("#divSupp").hide();
					}
				}
			}).data("kendoComboBox");

			var plant = $("#PlantID").kendoDropDownList({
				dataValueField: "Plant",
				dataTextField: "ViewValue",
				dataSource: {
					transport: {
						read: function (options) {
							$.ajax({
								method: 'post',
								headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
								url: "@myurl" + 'DropDown/INQ',
								dataType: 'text',
								data: JSON.stringify({ Ftype: "Plant", Plant: "" })
							}).done(function (data, textStatus, jqXHR) {
								try {
									var result = JSON.parse(data);
								}
								catch (e) {
									swal.fire('Error', 'Error loading grid', 'error');
									options.success({ data: [] });
									return;
								}
								options.success(result);
							}).fail(function (jqXHR, textStatus, errorThrown) {
								swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
								options.success({ data: [] });
							});
						}
					}
				}
			}).data("kendoDropDownList");

			$("#BuildingId").kendoDropDownList({
				cascadeFrom: "PlantID",
				autoBind: false,
				dataValueField: "IdValue",
				dataTextField: "ViewValue",
				dataSource: {
					transport: {
						read: function (options) {
							$.ajax({
								method: 'post',
								headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
								url: "@myurl" + 'DropDown/INQ',
								dataType: 'text',
								data: JSON.stringify({ Ftype: "Gedung", Plant: "" })
							}).done(function (data, textStatus, jqXHR) {
								try {
									var result = JSON.parse(data);
									console.log(data);
								}
								catch (e) {
									swal.fire('Error', 'Error loading grid', 'error');
									options.success({ data: [] });
									return;
								}
								options.success(result);
							}).fail(function (jqXHR, textStatus, errorThrown) {
								swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
								options.success({ data: [] });
							});
						}
					}
				}
			}).data("kendoDropDownList");

			var dept = $("#DeptId").kendoComboBox({
				cascadeFrom: "PlantID",
				autoBind: false,
				dataValueField: "IdValue",
				dataTextField: "ViewValue",
				filter: 'contains',
				dataSource: {
					transport: {
						read: function (options) {
							$.ajax({
								method: 'post',
								headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
								url: "@myurl" + 'DropDown/INQ',
								dataType: 'text',
								data: JSON.stringify({ Ftype: "Dept", Plant: "" })
							}).done(function (data, textStatus, jqXHR) {
								try {
									var result = JSON.parse(data);
									console.log(data);
								}
								catch (e) {
									swal.fire('Error', 'Error loading grid', 'error');
									options.success({ data: [] });
									return;
								}
								options.success(result);
							}).fail(function (jqXHR, textStatus, errorThrown) {
								swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
								options.success({ data: [] });
							});
						}
					}
				},
				change: function () {
					$("#SectionId").data('kendoComboBox').value('');

					if (this.value() && this.selectedIndex == -1) {
						this._filterSource({
							value: this.value(),
							field: this.options.dataTextField,
							operator: "contains"
						});
						this.select(0);
						if (this.selectedIndex == -1) {
							this.text("");
							this.value("");
						}
					}
				}
			}).data("kendoComboBox");

			var section = $("#SectionId").kendoComboBox({
				dataValueField: "IdValue",
				dataTextField: "ViewValue",
				filter: 'contains',
				autoBind: false,
				enable: false,
				dataSource: {
					transport: {
						read: function (options) {
							$.ajax({
								method: 'post',
								headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
								url: "@myurl" + 'DropDown/INQ',
								dataType: 'text',
								data: JSON.stringify({ Ftype: "Section", Plant: '', DeptID: '' })
							}).done(function (data, textStatus, jqXHR) {
								try {
									var result = JSON.parse(data);
									console.log(data);
								}
								catch (e) {
									swal.fire('Error', 'Error loading grid', 'error');
									options.success({ data: [] });
									return;
								}
								options.success(result);
							}).fail(function (jqXHR, textStatus, errorThrown) {
								swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
								options.success({ data: [] });
							});
						}
					}
				},
				change: function (e) {
					if (this.value() && this.selectedIndex == -1) {
						this._filterSource({
							value: this.value(),
							field: this.options.dataTextField,
							operator: "contains"
						});
						this.select(0);
						if (this.selectedIndex == -1) {
							this.text("");
							this.value("");
						}
					}
				}
			}).data("kendoComboBox");

			function cascade() {
				if (plant.value() && dept.value()) {
					section.enable(true);
					section.dataSource.filter([
						{ field: "Plant", operator: "eq", value: plant.value() },
						{ field: "DeptID", operator: "eq", value: dept.value() }
					]);
				} else {
					section.value("");
					section.enable(false);
				}
			}
			
			plant.bind("cascade", cascade);
			dept.bind("cascade", cascade);

			$("#SupplierCode").kendoComboBox({
				dataValueField: "IdValue",
				dataTextField: "ViewValue",
				filter: "contains",
				dataSource: {
					transport: {
						read: function (options) {
							$.ajax({
								method: 'post',
								headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
								url: "@myurl" + 'DropDown/INQ',
								dataType: 'text',
								data: JSON.stringify({ Ftype: "Supplier", Plant: "" })
							}).done(function (data, textStatus, jqXHR) {
								try {
									var result = JSON.parse(data);
								}
								catch (e) {
									swal.fire('Error', 'Error loading grid', 'error');
									options.success({ data: [] });
									return;
								}
								options.success(result);
							}).fail(function (jqXHR, textStatus, errorThrown) {
								swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
								options.success({ data: [] });
							});
						}
					}
				},
				change: function(){
					if (this.value() && this.selectedIndex == -1) {
						this.text("");
						this.value(null);
					}
				}
			}).data("kendoComboBox");

			$("#divSupp").hide();
		}
	};

	$(function () {
		AppD.init();
	});
</script>

<script type="text/x-kendo-template" id="template_toolbar">
	<span class="k-pager-refresh" style="font-weight: bold">&nbsp;&nbsp;- Master User -&nbsp;&nbsp;</span>
	<div class="toolbar">
	@if (Context.Session.GetString("add_master_user") == "True")
	{
		<button data-toggle="tooltip" title="Create" type="button" class="btn ink-reaction btn-floating-action btn-xs btn-warning" id="btnCreate">
			<i class="k-icon k-i-plus"></i>
		</button>
	}
		<button data-toggle="tooltip" title="Save as Excel" type="button" class="btn ink-reaction btn-floating-action btn-xs btn-warning" id="btnExcel">
			<i class="k-icon k-i-excel"></i>
		</button>
	</div>
</script>