@{
    ViewData["Title"] = "Master Part";
	string myurl = new ConfigurationBuilder().AddJsonFile("appsettings.json").Build().GetSection("Path:URL").Value;
}

<style>
    .k-dropdown-wrap .k-input, .k-numeric-wrap .k-input, .k-picker-wrap .k-input {
        height: 30px;
    }
</style>

<div id="qr_code" style="display:none;"></div>

<div class="page-main">
    <div class="page-content padding-5">
        <div id="grid" style="margin-top:5px; margin-bottom:5px;"></div>
    </div>
</div>

<div class="modal fade modal-primary" id="editor" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h4 class="modal-title" id="myModalTitle">Master Part</h4>
			</div>
			<div class="modal-body margin-bottom-0 padding-bottom-0">
				<div class="panel">
					<div class="panel-body">
						<form class="form-horizontal">
                            <div class="col-md-12">
                                <div class="form-group form-material col-md-6">
                                    <label class="col-sm-3 control-label">Plant</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="" id="PlantID" style="width:100%" required />
                                    </div>
                                </div>
                                <div class="form-group form-material col-md-6">
                                    <label class="col-sm-3 control-label">Gedung</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="" id="BuildingId" style="width:100%" required />
                                    </div>
                                </div>
                                <div class="form-group form-material col-md-6">
                                    <label class="col-sm-3 control-label">Line</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="" id="LineID" style="width:100%" required />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group form-material col-md-6">
                                    <label class="col-sm-3 control-label">Part Number</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="PartNumber" required />
                                    </div>
                                </div>
                                <div class="form-group form-material col-md-6">
                                    <label class="col-sm-3 control-label">Part Name</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="PartName" required />
                                    </div>
                                </div>
                                <div class="form-group form-material col-md-6">
                                    <label class="col-sm-3 control-label">Part Desc.</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="PartDesc" required />
                                    </div>
                                </div>
							</div>
                            <div class="col-md-12">
                                <label class="col-sm-12" style="text-align:center;padding-top:10px;">Details</label>
                                <div class="form-group form-material col-md-6">
                                    <label class="col-sm-3 control-label">Cycle Time (second)</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="CycleTime" style="width:100%" required />
                                    </div>
                                </div>
                                <div class="form-group form-material col-md-6">
                                    <label class="col-sm-3 control-label">Efficiency (%)</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control kendoNumber" id="Efficiency" style="width:100%" required />
                                    </div>
                                </div>
                                <div class="form-group form-material col-md-6">
                                    <label class="col-sm-3 control-label">Qty Fix per Pallet</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control kendoNumber" id="QtyperPallet" style="width:100%" required />
                                    </div>
                                </div>
                                <div class="form-group form-material col-md-6">
                                    <label class="col-sm-3 control-label">Pallet Prod per Day</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control kendoNumber" id="QtyProdPerDay" style="width:100%" required />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <label class="col-sm-12" style="text-align:center;padding-top:10px;">Standart Stock Part (pcs)</label>
                                <div class="form-group form-material col-md-6">
                                    <label class="col-sm-3 control-label">Minimum</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control kendoNumber" id="PartStockMin" style="width:100%" required />
                                    </div>
                                </div>
                                <div class="form-group form-material col-md-6">
                                    <label class="col-sm-3 control-label">Maximum</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control kendoNumber" id="PartStockMax" style="width:100%" required />
                                    </div>
                                </div>
                                <div class="form-group form-material col-md-6">
                                    <label class="col-sm-3 control-label">1 Day</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control kendoNumber" id="PartStockDay" style="width:100%" required />
                                    </div>
                                </div>
                                <div class="form-group form-material col-md-6">
                                    <label class="col-sm-3 control-label">Cycle Max</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control kendoNumber" id="CycleMax" style="width:100%" required />
                                    </div>
                                </div>
							</div>
							<div class="clearfix"></div>
						</form>
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal" id='clear'>Close</button>
				<button type="button" class="btn btn-primary" id="btnSave">Submit</button>
			</div>
		</div>
	</div>
</div>

<div class="modal fade modal-primary" id="editorUpload" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="padding-top:25vh;">
    <div class="" role="document" style="padding-left:25vw;">
        <div class="modal-content" style="width:50vw">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="myModalTitle">Upload Master Part</h4>
            </div>
            <div class="modal-body margin-bottom-0 padding-bottom-0">
                <form id="formUpload" enctype="multipart/form-data">
                    <span>Download template <a href="../../templates/Master Part.xlsx" style="color:#0099ff" download="Template Master Part.xlsx">here</a></span>
                    <input type="file" name="file" class="form-control" id="fileUpload" accept=".xls,.xlsx" />
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" id='clear'>Close</button>
                <button type="button" class="btn btn-primary" id="btnSaveUpload" value="Upload">Upload</button>
            </div>
        </div>
    </div>
</div>

<script>
    var IUType = "I";
    
    var AppD = {
        attachEvents: function () {
            var o = this;
            o.dom.$btnSave.on('click', o.eventHandlers.onClickBtnSave.bind(o));
            o.dom.$btnSaveUpload.on('click', o.eventHandlers.onClickBtnSaveUpload.bind(o));

            o.dom.$grid.on('click', '#btnCreate', o.eventHandlers.onClickBtnCreate.bind(o));
            o.dom.$grid.on('click', '#btnExcel', o.eventHandlers.onClickBtnExcel.bind(o));
            o.dom.$grid.on('click', '#btnUpload', o.eventHandlers.onClickBtnUpload.bind(o));
            
			o.dom.$grid.on('click', '.btnUpdate', o.eventHandlers.onClickBtnUpdate.bind(o));
            o.dom.$grid.on('click', '.btnDelete', o.eventHandlers.onClickBtnDelete.bind(o));
            o.dom.$grid.on('click', '.btnBlank', o.eventHandlers.onClickBtnBlank.bind(o));
            o.dom.$grid.on('click', '.btnVacuum', o.eventHandlers.onClickBtnVacuum.bind(o));
        },
        cacheDom: function () {
            var o = this;
            o.dom.$editor = $("#editor");
            o.dom.$editorUpload = $("#editorUpload");
            o.dom.$grid = $("#grid");
            o.dom.inputs = {};
            o.dom.$btnSave = $("#btnSave");
            o.dom.$btnSaveUpload = $("#btnSaveUpload");
        },
        data: {
            PartQty: ''
        },
        dom: {},
        eventHandlers: {
            onClickBtnCreate: function () {
                var o = this;
                IUType = "I";
                
                $("#PlantID").data("kendoDropDownList").value("");
                $("#BuildingId").data("kendoDropDownList").value("");
                $("#LineID").data("kendoDropDownList").value("");
                $("#PartNumber").val("");
                $("#PartName").val("");
                $("#PartDesc").val("");
                $("#CycleTime").data("kendoNumericTextBox").value("");
                $("#Efficiency").data("kendoNumericTextBox").value("");
                $("#QtyperPallet").data("kendoNumericTextBox").value("");
                $("#QtyProdPerDay").data("kendoNumericTextBox").value("");
                $("#PartStockMin").data("kendoNumericTextBox").value("");
                $("#PartStockMax").data("kendoNumericTextBox").value("");
                $("#PartStockDay").data("kendoNumericTextBox").value("");
                $("#CycleMax").data("kendoNumericTextBox").value("");

                $("#PlantID").data("kendoDropDownList").enable(true);
                document.getElementById("PartNumber").disabled = false;

                o.dom.$editor.modal('show');
            },
            onClickBtnUpload: function () {
                var o = this;
                $("#fileUpload").data('kendoUpload').clearAllFiles();
                o.dom.$editorUpload.modal('show');
            },
            onClickBtnSaveUpload: function () {
                var o = this;
                swal.fire({
                    title: 'Upload Master Part?',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Yes'
                }).then((result) => {
                    if (result.isConfirmed) {
                        let formData = new FormData();
                        let files = $("#fileUpload").data('kendoUpload').getFiles();
                        let file = files[0].rawFile;
                        formData.append('file', file);

                        $.ajax({
                            url: "@myurl" + "MasterPart/Upload?UID=" + "@Context.Session.GetString("PIC_ID")",
                            headers: { 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
                            type: 'post',
                            data: formData,
                            contentType: false,
                            processData: false
                        }).done(function () {
                            o.dom.$editorUpload.modal('hide');
                            swal.fire({ title: 'Success', text: 'Data Uploaded', icon: 'success', timer: 2000, showConfirmButton: false });
                            $("#fileUpload").data('kendoUpload').clearAllFiles();
                        }).always(function (data_or_jqXHR, textStatus, jqXHR_or_errorThrown) {
                            $("#grid").data('kendoGrid').dataSource.read();
                            $("#fileUpload").data('kendoUpload').clearAllFiles();
                        });
                    }
                });
            },
			onClickBtnUpdate: function (e) {
				var o = this;
                IUType = "U";
                var di = o.dom.$grid.data('kendoGrid').dataItem($(e.target).closest('tr'));

                $("#PlantID").data("kendoDropDownList").value(di.PlantID);
                $("#BuildingId").data("kendoDropDownList").value(di.BuildingID);
                $("#LineID").data("kendoDropDownList").value(di.LineID);
                $("#PartNumber").val(di.PartNumber);
                $("#PartName").val(di.PartName);
                $("#PartDesc").val(di.PartDesc);
                $("#CycleTime").data("kendoNumericTextBox").value(di.CycleTimeSec.replace(",", "."));
                $("#Efficiency").data("kendoNumericTextBox").value(di.Efficiency);
                $("#QtyperPallet").data("kendoNumericTextBox").value(di.QtyperPallet);
                $("#QtyProdPerDay").data("kendoNumericTextBox").value(di.QtyProdPerDay);
                $("#PartStockMin").data("kendoNumericTextBox").value(di.PartStockMin);
                $("#PartStockMax").data("kendoNumericTextBox").value(di.PartStockMax);
                $("#PartStockDay").data("kendoNumericTextBox").value(di.PartStockDay);
                $("#CycleMax").data("kendoNumericTextBox").value(di.CycleMax);

                $("#PlantID").data("kendoDropDownList").enable(false);
                $("#BuildingId").data("kendoDropDownList").enable(false);
                $("#LineID").data("kendoDropDownList").enable(false);
                document.getElementById("PartNumber").disabled = true;

                o.dom.$editor.modal('show');
			},
            onClickBtnDelete: function (e) {
                var o = this;
                var di = o.dom.$grid.data('kendoGrid').dataItem($(e.target).closest('tr'));

                swal.fire({
                    title: 'Delete?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Yes'
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.ajax({
                            method: 'post',
                            headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
                            url: "@myurl"+'MasterPart/DEL',
                            dataType: 'text',
                            data: JSON.stringify({
                                PartNumber: di.PartNumber,
                                LineID: di.LineID
                            })
                        }).done(function (data, textStatus, jqXHR) {
                            if (data !== 'success') {
                                swal.fire('', data, 'error');
                                return;
                            }
                            swal.fire({ title: 'Success', text: 'Data deleted', icon: 'success', timer: 2000, showConfirmButton: false });
                        }).fail(function (jqXHR, textStatus, errorThrown) {
                            swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
                        }).always(function (data_or_jqXHR, textStatus, jqXHR_or_errorThrown) {
                            o.dom.$grid.data('kendoGrid').dataSource.read();
                        });
                    }
                });
            },
            onClickBtnExcel: function () {
                var o = this;
                o.dom.$grid.data('kendoGrid').saveAsExcel();
            },
            onClickBtnSave: function () {
                var o = this;
                PartNumber = $("#PartNumber").val();
                PartName = $("#PartName").val();
                PartDesc = $("#PartDesc").val();
                CycleTime = $("#CycleTime").val();
                Efficiency = $("#Efficiency").val();
                LineID = $("#LineID").val();
                QtyperPallet = $("#QtyperPallet").val();
                QtyProdPerDay = $("#QtyProdPerDay").val();
                PartStockMin = $("#PartStockMin").val();
                PartStockMax = $("#PartStockMax").val();
                PartStockDay = $("#PartStockDay").val();
                CycleMax = $("#CycleMax").val();

                if (PartNumber != '' && LineID != '') {
                    swal.fire({
                        title: "Save?",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonText: 'Yes'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            $.ajax({
                                method: 'post',
                                headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
                                url: "@myurl" + 'MasterPart/INS',
                                dataType: 'text',
                                data: JSON.stringify({
                                    IUType: IUType,
                                    PartNumber: PartNumber,
                                    PartName: PartName,
                                    PartDesc: PartDesc,
                                    CycleTimeSec: CycleTime,
                                    Efficiency: Efficiency,
                                    LineID: LineID,
                                    QtyperPallet: QtyperPallet,
                                    QtyProdPerDay: QtyProdPerDay,
                                    PartStockMin: PartStockMin,
                                    PartStockMax: PartStockMax,
                                    PartStockDay: PartStockDay,
                                    CycleMax: CycleMax,
                                    UserLogin: "@Context.Session.GetString("PIC_ID")"
                                })
                            }).done(function (data, textStatus, jqXHR) {
                                if (data !== 'success') {
                                    swal.fire('Error', data, 'error');
                                    return;
                                }
                                o.dom.$editor.modal('hide');
                                swal.fire({ title: 'Success', text: 'Data saved', icon: 'success', timer: 2000, showConfirmButton: false });
                            }).fail(function (jqXHR, textStatus, errorThrown) {
                                swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
                            }).always(function (data_or_jqXHR, textStatus, jqXHR_or_errorThrown) {
                                o.dom.$grid.data('kendoGrid').dataSource.read();
                            });
                        }
                    });
                } else {
                    swal.fire({ title: 'Warning', text: 'Please fill all fields', icon: 'warning' });
                }
            },
            onClickBtnBlank: function (e) {
                var o = this;
                var di = o.dom.$grid.data('kendoGrid').dataItem($(e.target).closest('tr'));

                swal.fire({
                    title: "Print QR Blank for " + di.PartNumber + "?",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Yes'
                }).then((result) => {
                    if (result.isConfirmed) {
                        o.fn.printQR.call(o, '2', di.PartNumber, di.PartDesc, di.QtyperPallet);
                    }
                });
            },
            onClickBtnVacuum: function (e) {
                var o = this;
                var di = o.dom.$grid.data('kendoGrid').dataItem($(e.target).closest('tr'));

                swal.fire({
                    title: "Print QR Vacuum for " + di.PartNumber + "?",
                    icon: 'warning',
                    showCancelButton: true,
                    input: 'number',
                    inputPlaceholder: 'Part Qty',
                    confirmButtonText: 'Yes',
                    preConfirm: (PartQty) => {
                        if (!PartQty) {
                            swal.showValidationMessage('Part Qty is mandatory');
                        } else {
                            o.data.PartQty = PartQty;
                        }
                    },
                }).then((result) => {
                    if (result.isConfirmed) {
                        o.fn.printQR.call(o, '1', di.PartNumber, di.PartDesc, o.data.PartQty);
                    }
                });
            },
        },
        fn: {
            printQR: function (QRType, PartNumber, PartDesc, PartQty) {
                var TopHeader = 'PT ASTRA DAIHATSU MOTOR';
                var TopHeader2 = '- CASTING PLANT TO ENGINE PLANT';
                var type = ''

                if (QRType == '1') type = 'VACUUM DUMMY';
                else type = 'BLANK DUMMY'
                var MatQty = PartQty + " Pcs";

                let pg = 0;
                var fileName = type + "_" + PartNumber;

                var pdf = new jsPDF({
                    orientation: "p",
                    unit: "mm",
                    format: "a4"
                });

                $("#qr_code").html("");
                $('#qr_code').qrcode(QRType + ";" + PartNumber + ";" + PartQty);
                var canvas = document.querySelector("#qr_code canvas");
                var img = canvas.toDataURL("image/jpeg", 1);

                pdf.setLineWidth(0.3);
                pdf.rect(10, 5, 190, 138.5);

                pdf.setFontSize(12);
                pdf.setFontStyle("bold");
                pdf.setTextColor(255, 0, 0);
                pdf.text(TopHeader, 35.5, 17);
                pdf.setTextColor(0, 0, 0);
                pdf.text(TopHeader2, 97.5, 17);

                pdf.setFontSize(30);
                pdf.text(type, 105, 30, "center");

                pdf.setFontSize(20);
                pdf.setTextColor(0, 176, 240);
                pdf.text("QR CODE RFID", 105, 40, "center");

                pdf.setFillColor(0, 0, 0);
                pdf.rect(15, 45, 180, 30, "F");
                pdf.setFillColor(255, 255, 0);
                pdf.rect(15.3, 45.3, 179.4, 29.4, "F");

                pdf.setTextColor(0, 0, 0);
                pdf.text(PartDesc, 105, 55, "center");
                pdf.text(PartNumber, 77.5, 67.5, "center");
                pdf.setLineWidth(0.7);
                pdf.line(140, 60, 140, 70);
                pdf.text(MatQty, 167.5, 67.5, "center");

                pdf.setLineWidth(0.3);
                pdf.rect(15, 79, 180, 60);
                pdf.addImage(img, 'png', 80, 84, 50, 50);

                pdf.save(fileName + '.pdf');
            }
        },
        init: function () {
            var o = this;
            o.cacheDom();
            o.attachEvents();
            o.initElements();
        },
        initElements: function () {
            var o = this;

            o.dom.$grid.kendoGrid({
                excel: {
                    fileName: "Master Part.xlsx",
                    allPages: true,
                    filterable: true
                },
                dataSource: {
                    transport: {
                        read: function (options) {
                            $.ajax({
                                method: 'post',
                                headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
                                url: "@myurl"+'MasterPart/INQ',
                                dataType: 'text',
                                data: {}
                            }).done(function (data, textStatus, jqXHR) {
                                try {
                                    var result = JSON.parse(data);
                                }
                                catch (e) {
                                    swal.fire('Error', 'Error loading grid', 'error');
                                    options.success({ data: [] });
                                    return;
                                }
                                options.success(result);
                            }).fail(function (jqXHR, textStatus, errorThrown) {
                                swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
                                options.success({ data: [] });
                            });
                        }
                    },
                    schema: {
                        model: {
                            id: "PartNumber",
                            fields: {
                                PlantID: { type: "string" },
                                PlantName: { type: "string" },
                                BuildingID: { type: "string" },
                                BuildingName: { type: "string" },
                                PartNumber: { type: "string" },
                                PartName: { type: "string" },
                                PartDesc: { type: "string" },
                                CycleTimeMin: { type: "string" },
                                CycleTimeSec: { type: "string" },
                                Efficiency: { type: "string" },
                                LineID: { type: "string" },
                                LineName: { type: "string" },
                                QtyperPallet: { type: "string" },
                                QtyProdPerDay: { type: "string" },
                                PartStockMin: { type: "string" },
                                PartStockMax: { type: "string" },
                                PartStockDay: { type: "string" },
                                CycleMax: { type: "string" },
                                UserUpdate: { type: "string" },
                                LastUpdate: { type: "string" },
                                Remarks: { type: "string" }
                            }
                        }
                    },
                    pageSize: 20
                },
                scrollable: true,
                sortable: true,
                resizable: true,
                reorderable: true,
                filterable: {
                    extra: false,
                    operators: {
                        string: {
                            contains: "Contains",
                            eq: "Equal to",
                            neq: "Not equal to"
                        }
                    }
                },
                pageable: {
                    refresh: true,
                    input: true,
                    numeric: true,
                    pageSizes: true,
                    buttonCount: 5
                },
                columns: [
                @if(Context.Session.GetString("edit_master_part") == "True")
                {
                    <text>
                    {
                        width: 50,
                        command: [{
                            name: "Update",
                            text: "<i class='fa fa-pencil-square-o btnUpdate' style='font-size:18px;color:#737373;'></i>"
                        }]
                    },
                    </text>
                }
                @if (Context.Session.GetString("del_master_part") == "True")
                {
                    <text>
                    {
                        width: 50,
                        command: [{
                            name: "Delete",
                            text: "<i class='fa fa-trash-o btnDelete' style='font-size:18px;color:#800000;'></i>"
                        }]
                    },
                    </text>
                }
                @if (Context.Session.GetString("edit_master_part") == "True")
                {
                    <text>
                    {
                        title: "QR Blank",
                        width: 50,
                        command: [{
                            name: "QRBlank",
                            text: "<i class='fa fa-qrcode btnBlank' title='QR Blank' style='font-size:18px;'></i>"
                        }]
                    },
                    </text>
                }
                @if (Context.Session.GetString("edit_master_part") == "True")
                {
                    <text>
                    {
                        title: "QR Vacuum",
                        width: 50,
                        command: [{
                            name: "QRVacuum",
                            text: "<i class='fa fa-qrcode btnVacuum' title='QR Vacuum' style='font-size:18px;'></i>"
                        }]
                    },
                    </text>
                }
                {
                    field: "PlantID",
                    title: "Plant",
                    width: 80
                },
                {
                    title: "Gedung",
                    columns: [
                        {
                            field: "BuildingID",
                            title: "ID",
                            width: 50
                        },
                        {
                            field: "BuildingName",
                            title: "Name",
                            width: 80
                        }]
                },
                {
                    title: "Line",
                    columns: [
                        {
                            field: "LineID",
                            title: "ID",
                            width: 50
                        },
                        {
                            field: "LineName",
                            title: "Name",
                            width: 80
                        }]
                },
                {
                    field: "PartNumber",
                    title: "Part No.",
                    width: 120
                },
                {
                    field: "PartName",
                    title: "Part Name",
                    width: 200,
                    template: "<div class='customClass'> #= (PartName == null) ? ' ' : kendo.toString(PartName, '') # </div>",
                },
                {
                    field: "PartDesc",
                    title: "Part Desc.",
                    width: 200,
                    template: "<div class='customClass'> #= (PartDesc == null) ? ' ' : kendo.toString(PartDesc, '') # </div>",
                },
                {
                    title: "Cycle Time",
                    columns: [
                    {
                        field: "CycleTimeMin",
                        title: "Min.",
                        width: 80
                    },
                    {
                        field: "CycleTimeSec",
                        title: "Sec.",
                        width: 80
                    }]
                },
                {
                    field: "Efficiency",
                    title: "Eff (%)",
                    width: 50
                },
                {
                    field: "QtyperPallet",
                    title: "Qty Per Pallet",
                    width: 120
                },
                {
                    field: "QtyProdPerDay",
                    title: "Qty Pallet/Day",
                    width: 120
                },
                {
                    title: "Standar Stock Part (PCS)",
                    columns: [
                    {
                        field: "PartStockMin",
                        title: "MIN",
                        width: 80
                    },
                    {
                        field: "PartStockMax",
                        title: "MAX",
                        width: 80
                    },
                    {
                        field: "PartStockDay",
                        title: "1 Day",
                        width: 80
                    }]
                },
                {
                    field: "CycleMax",
                    title: "CycleMax",
                    width: 80
                },
                {
                    title: "Last Update",
                    columns: [
                    {
                        field: "UserUpdate",
                        title: "User",
                        width: 120
                    },
                    {
                        field: "LastUpdate",
                        title: "Date",
                        width: 150
                    }]
                }],
                toolbar: $("#template_toolbar").html(),
            });

            $("#fileUpload").kendoUpload({
                multiple: false,
                validation: {
                    allowedExtensions: [".xls", "xlsx"]
                }
            });

            var plant = $("#PlantID").kendoDropDownList({
                dataValueField: "Plant",
                dataTextField: "ViewValue",
                dataSource: {
                    transport: {
                        read: function (options) {
                            $.ajax({
                                method: 'post',
                                headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
                                url: "@myurl" + 'DropDown/INQ',
                                dataType: 'text',
                                data: JSON.stringify({ Ftype: "Plant", Plant: "" })
                            }).done(function (data, textStatus, jqXHR) {
                                try {
                                    var result = JSON.parse(data);
                                }
                                catch (e) {
                                    swal.fire('Error', 'Error loading grid', 'error');
                                    options.success({ data: [] });
                                    return;
                                }
                                options.success(result);
                            }).fail(function (jqXHR, textStatus, errorThrown) {
                                swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
                                options.success({ data: [] });
                            });
                        }
                    }
                }
            }).data("kendoDropDownList");

            var gedung = $("#BuildingId").kendoDropDownList({
                cascadeFrom: "PlantID",
                autoBind: false,
                dataValueField: "IdValue",
                dataTextField: "ViewValue",
                dataSource: {
                    transport: {
                        read: function (options) {
                            $.ajax({
                                method: 'post',
                                headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
                                url: "@myurl" + 'DropDown/INQ',
                                dataType: 'text',
                                data: JSON.stringify({ Ftype: "Gedung", Plant: "" })
                            }).done(function (data, textStatus, jqXHR) {
                                try {
                                    var result = JSON.parse(data);
                                    console.log(data);
                                }
                                catch (e) {
                                    swal.fire('Error', 'Error loading grid', 'error');
                                    options.success({ data: [] });
                                    return;
                                }
                                options.success(result);
                            }).fail(function (jqXHR, textStatus, errorThrown) {
                                swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
                                options.success({ data: [] });
                            });
                        }
                    }
                },
                change: function () { 
                    $("#LineID").data('kendoDropDownList').value('');
                }
            }).data("kendoDropDownList");

            var line = $("#LineID").kendoDropDownList({
                autoBind: false,
                enable: false,
                dataValueField: "IdValue",
                dataTextField: "ViewValue",
                dataSource: {
                    transport: {
                        read: function (options) {
                            $.ajax({
                                method: 'post',
                                headers: { 'Content-Type': 'application/json', 'XApiKey': 'pgH7QzFHJx4w46fI~5Uzi4RvtTwlEXp' },
                                url: "@myurl" + 'DropDown/INQ',
                                dataType: 'text',
                                data: JSON.stringify({ Ftype: "Line", Plant: "", BuildingId: "" })
                            }).done(function (data, textStatus, jqXHR) {
                                try {
                                    var result = JSON.parse(data);
                                    console.log(data);
                                }
                                catch (e) {
                                    swal.fire('Error', 'Error loading grid', 'error');
                                    options.success({ data: [] });
                                    return;
                                }
                                options.success(result);
                            }).fail(function (jqXHR, textStatus, errorThrown) {
                                swal.fire('Error', (jqXHR.responseText !== '' ? ': ' + jqXHR.responseText : ''), 'error');
                                options.success({ data: [] });
                            });
                        }
                    }
                }
            }).data("kendoDropDownList");
            
            $(".kendoNumber").kendoNumericTextBox({
                format: "#",
                min: 0
            });

            $("#CycleTime").kendoNumericTextBox({
                format: "{0:0.00}",
                min: 0
            })

            function cascade() {
                if (plant.value() && gedung.value()) {
                    line.enable(true);
                    line.dataSource.filter([
                        { field: "Plant", operator: "eq", value: plant.value() },
                        { field: "BuildingId", operator: "eq", value: gedung.value() }
                    ]);
                } else {
                    line.value("");
                    line.enable(false);
                }
            }

            plant.bind("cascade", cascade);
            gedung.bind("cascade", cascade);
        }
    };

    $(function () {
        AppD.init();
    });
</script>

<script type="text/x-kendo-template" id="template_toolbar">
    <span class="k-pager-refresh" style="font-weight: bold">&nbsp;&nbsp;- Master Part -&nbsp;&nbsp;</span>
    <div class="toolbar">
    @if (Context.Session.GetString("add_master_part") == "True")
    {
        <button data-toggle="tooltip" title="Create" type="button" class="btn ink-reaction btn-floating-action btn-xs btn-warning" id="btnCreate">
            <i class="k-icon k-i-plus"></i>
        </button>
        <button data-toggle="tooltip" title="Upload" type="button" class="btn ink-reaction btn-floating-action btn-xs btn-warning" id="btnUpload">
            <i class="k-icon k-i-upload"></i>
        </button>
    }
        <button data-toggle="tooltip" title="Save as Excel" type="button" class="btn ink-reaction btn-floating-action btn-xs btn-warning" id="btnExcel">
            <i class="k-icon k-i-excel"></i>
        </button>
    </div>
</script>